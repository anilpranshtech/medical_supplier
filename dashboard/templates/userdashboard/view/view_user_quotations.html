{% extends "pages/base.html" %}
{% load static %}

{% block content %}
<title>RFQ Quotations</title>

<div class="max-w-[90%] mx-auto mt-6 text-gray-900 dark:text-gray-100">
    <h2 class="text-3xl font-bold mb-6">ðŸ“¦ RFQ Quotations</h2>

    <!-- Toggle Buttons -->
    <div class="flex gap-3 mb-8">
        <button class="px-5 py-2.5 rounded-lg text-sm font-semibold transition bg-blue-600 text-white active shadow-md hover:bg-blue-700" data-kt-tab-toggle="#sent_quotations">
            Sent Quotations
        </button>
        <button class="px-5 py-2.5 rounded-lg text-sm font-semibold bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition shadow-sm" data-kt-tab-toggle="#received_quotations">
            Received Quotations
        </button>
    </div>

    <div class="tab-content space-y-8">

        <!-- Sent Quotations -->
        <div class="tab-pane" id="sent_quotations">
            {% if sent_quotations %}
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for rfq in sent_quotations %}
                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-5 hover:shadow-xl transition">
                    <div class="text-lg font-semibold text-blue-600 dark:text-blue-400">RFQ #{{ rfq.id }}</div>
                    <ul class="mt-3 space-y-1 text-sm text-gray-700 dark:text-gray-300">
                        <li><strong>Product:</strong> {{ rfq.product.name }}</li>
                        <li><strong>Buyer:</strong> {{ rfq.requested_by.username }}</li>
                        <li><strong>Price:</strong> {% if rfq.quoted_price %}â‚¹{{ rfq.quoted_price|floatformat:2 }}{% else %}â€”{% endif %}</li>
                        <li><strong>Delivery:</strong> {{ rfq.quote_delivery_date|default:"â€”" }}</li>
                        <li><strong>Notes:</strong> {{ rfq.supplier_notes|default:"â€”"|truncatewords:10 }}</li>
                        <li><strong>File:</strong> {% if rfq.quote_attached_file %}<a href="{{ rfq.quote_attached_file.url }}" class="underline text-blue-600 dark:text-blue-400" target="_blank">Download</a>{% else %}â€”{% endif %}</li>
                        <li><strong>Sent At:</strong> {{ rfq.quote_sent_at|date:"Y-m-d H:i" }}</li>
                    </ul>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-base text-gray-500 dark:text-gray-400">No sent quotations found.</p>
            {% endif %}
        </div>

        <!-- Received Quotations -->
        <div class="tab-pane hidden" id="received_quotations">
            {% if received_quotations %}
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for rfq in received_quotations %}
                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-5 hover:shadow-xl transition">
                    <div class="text-lg font-semibold text-green-600 dark:text-green-400">RFQ #{{ rfq.id }}</div>
                    <ul class="mt-3 space-y-1 text-sm text-gray-700 dark:text-gray-300">
                        <li><strong>Product:</strong> {{ rfq.product.name }}</li>
                        <li><strong>Supplier:</strong> {{ rfq.quoted_by.username|default:"â€”" }}</li>
                        <li><strong>Price:</strong> {% if rfq.quoted_price %}â‚¹{{ rfq.quoted_price|floatformat:2 }}{% else %}â€”{% endif %}</li>
                        <li><strong>Delivery:</strong> {{ rfq.quote_delivery_date|default:"â€”" }}</li>
                        <li><strong>Notes:</strong> {{ rfq.supplier_notes|default:"â€”"|truncatewords:10 }}</li>
                        <li><strong>File:</strong> {% if rfq.quote_attached_file %}<a href="{{ rfq.quote_attached_file.url }}" class="underline text-blue-600 dark:text-blue-400" target="_blank">Download</a>{% else %}â€”{% endif %}</li>
                        <li><strong>Received At:</strong> {{ rfq.quote_sent_at|date:"Y-m-d H:i" }}</li>
                    </ul>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-base text-gray-500 dark:text-gray-400">No received quotations found.</p>
            {% endif %}
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const tabs = document.querySelectorAll('[data-kt-tab-toggle]');
        const panes = document.querySelectorAll('.tab-pane');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('bg-blue-600', 'text-white', 'active'));
                tab.classList.add('bg-blue-600', 'text-white', 'active');

                panes.forEach(p => p.classList.add('hidden'));
                const target = document.querySelector(tab.dataset.ktTabToggle);
                if (target) target.classList.remove('hidden');
            });
        });
    });
</script>

{% endblock %}
