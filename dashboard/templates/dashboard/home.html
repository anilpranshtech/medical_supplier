{% extends "pages/base.html" %}
{% load static %}

{% block content %}
<title>Medical Supplies</title>
<style>
     /* Modal styles */
    #loginRequiredModal, #rfqModal, #imageModal, #eventRegistrationModal, #questionModal {
        z-index: 9999;
        backdrop-filter: blur(8px);
        background-color: rgba(0, 0, 0, 0.4);
    }
    .text-red-500 {
        color: #ef4444 !important;
    }

    .heart-icon {
        transition: color 0.2s ease-in-out;
    }

    /* Slider Styles */
    .kt-slider-container {
        width: 100%;
        max-width: 1600px;
        height: 265px;
        overflow: hidden;
        position: relative;
        background: white;
        margin-left: auto;
        margin-right: auto;
        margin-top: 1.75rem;
    }

    .kt-slider {
        display: flex;
        transition: transform 0.5s ease-in-out;
        height: 100%;
    }

    .kt-slide {
        min-width: 100%;
        width: 100%;
        height: 100%;
    }

    .kt-slide img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        aspect-ratio: 320 / 53;
    }

    .kt-nav-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(229, 231, 235, 0.8);
        padding: 0.5rem;
        border-radius: 9999px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        font-size: 1.5rem;
        line-height: 1;
        color: black;
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .kt-nav-btn:hover {
        background-color: var(--primary-color, #007bff);
        color: white;
    }

    .kt-nav-btn-left {
        left: 12px;
    }

    .kt-nav-btn-right {
        right: 12px;
    }

    /* Section Container */
    .section-container {
        max-width: var(--custom-container-width, 100%);
        margin-left: auto;
        margin-right: auto;
        margin-bottom: 1.5rem;
        padding: 0 15px;
    }

    /* Blur effect for background when modal is open */
    .modal-open {
        filter: blur(8px);
        transition: filter 0.3s ease-in-out;
    }

    /* Ensure modal content is not blurred */
    .kt-modal {
        filter: none !important;
    }

    /* Loader styles */
    .loader {
        display: none;
        border: 2px solid #ffffff;
        border-top: 2px solid transparent;
        border-radius: 50%;
        width: 16px;
        height: 16px;
        animation: spin 1s linear infinite;
        margin-left: 8px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .loading .loader {
        display: inline-block;
    }

    #loginRequiredModal, #rfqModal {
        z-index: 9999;
        backdrop-filter: blur(8px);
        background-color: rgba(0, 0, 0, 0.4);
    }

    .swiper-button-next,
    .swiper-button-prev {
        z-index: 10;
    }

    /* Product card styles */
    .product-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }

    /* Image hover effect for product cards */
    .section-container .product-card img {
        filter: grayscale(100%);
        transition: filter 0.3s ease;
    }

    .section-container .product-card:hover img {
        filter: grayscale(0%);
    }

    .section-container:hover .product-card img {
        filter: grayscale(100%);
    }

    .section-container .product-card:hover img {
        filter: grayscale(0%);
    }

    /* Image hover effect for special offers */
    .special-offers-container .kt-card img {
        filter: grayscale(100%);
        transition: filter 0.3s ease;
    }

    .special-offers-container:hover .kt-card img {
        filter: grayscale(100%);
    }

    .special-offers-container .kt-card:hover img {
        filter: grayscale(0%);
    }

    /* Responsive adjustments */
    @media (min-width: 1536px) {
        .xl\:grid-cols-8 {
            grid-template-columns: repeat(8, minmax(0, 1fr));
        }
    }

    @media (max-width: 1599px) {
        .kt-slider-container {
            height: calc(100vw * 265 / 1600);
        }
    }

    @media (max-width: 1280px) {
        .kt-slider-container {
            height: 200px;
        }

        .grid-cols-6 {
            grid-template-columns: repeat(4, minmax(0, 1fr));
        }
    }

    @media (max-width: 1024px) {
        .kt-slider-container {
            height: 180px;
        }

        .grid-cols-6 {
            grid-template-columns: repeat(3, minmax(0, 1fr));
        }

        .xl\:grid-cols-2 {
            grid-template-columns: 1fr;
        }

        .special-offer-card {
            flex-direction: column;
            text-align: center;
        }

        .special-offer-card img {
            margin-top: 20px;
        }
    }

    @media (max-width: 768px) {
        .kt-slider-container {
            height: 150px;
        }

        .grid-cols-6 {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }

        .xl\:grid-cols-4,
        .xl\:grid-cols-2 {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }

        .benefits-grid {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }

        .product-thumbnail {
            height: 120px !important;
        }

        .product-card-content {
            padding: 1rem !important;
        }
    }

    @media (max-width: 640px) {
        .kt-slider-container {
            height: 120px;
        }

        .grid-cols-6 {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }

        .xl\:grid-cols-4,
        .xl\:grid-cols-2 {
            grid-template-columns: 1fr;
        }

        .benefits-grid {
            grid-template-columns: 1fr;
        }

        .section-container {
            padding: 0 10px;
        }

        .kt-card-header h3 {
            font-size: 1.1rem;
        }

        .product-actions {
            flex-direction: column;
            gap: 0.5rem;
        }

        .product-actions button {
            width: 100%;
        }
    }

    @media (max-width: 480px) {
        .kt-slider-container {
            height: 100px;
        }

        .grid-cols-6 {
            grid-template-columns: 1fr;
        }

        .product-card {
            max-width: 100%;
        }

        .kt-modal {
            width: 95%;
        }

        .rfq-modal-content {
            padding: 1rem;
        }
    }

    @media (prefers-color-scheme: dark) {
        .kt-slider-container {
            background: #1a202c;
        }

        .kt-nav-btn {
            background: rgba(55, 65, 81, 0.8);
            color: white;
        }
    }

    /* Discount Ribbon Styles */
    .discount-ribbon {
        position: absolute;
        top: 10px;
        left: -25px;
        transform: rotate(-45deg);
        background-color: #dc2626;
        color: white;
        padding: 5px 30px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
        z-index: 1;
        clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%, 10% 50%);
    }

    .discount-ribbon:after {
        content: '';
        position: absolute;
        right: -20px;
        bottom: 0;
        width: 0;
        height: 0;
        border-left: 20px solid #dc2626;
        border-top: 10px solid transparent;
        border-bottom: 10px solid transparent;
    }

    .kt-wishlist-icon {
        cursor: pointer;
        transition: color 0.2s ease-in-out;
    }

    .kt-wishlist-icon:hover i {
        color: #ff0000;
    }

    .kt-wishlist-icon i {
        color: #6b7280;
    }

    .kt-wishlist-icon i.text-red-500 {
        color: #ff0000;
    }
</style>

<!-- Begin Medical Banner Slider -->
<div class="kt-slider-container mt-7" style="max-width: var(--custom-container-width, 99%); height: fit-content">
    <div class="kt-slider" id="slider">
        {% for banner in banners %}
            <a href="{{ banner.link|default:'#' }}" class="kt-slide">
                <img src="{{ banner.image.url }}" alt="{{ banner.title }}">
            </a>
        {% endfor %}
    </div>
    <button class="kt-nav-btn kt-nav-btn-left" onclick="prevSlide()" aria-label="Previous Slide">‹</button>
    <button class="kt-nav-btn kt-nav-btn-right" onclick="nextSlide()" aria-label="Next Slide">›</button>
</div>
<!-- End Medical Banner Slider -->

<!-- Begin Sections -->
<div class="kt-container-fixed" style="max-width: var(--custom-container-width, 95%);">
<!-- Featured Products -->
<div class="section-container">
    <div class="grid grid-cols-1 gap-6 mt-5 py-5">
        <!-- Product Grid -->
        <div class="grid grid-cols-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-2">
            {% for product in featured_products|slice:":6" %}
            <div class="kt-card product-card">
                <div class="kt-card-content flex flex-col justify-between p-2 gap-3 h-full">
                    <div>
                        <div class="kt-card flex items-center justify-center relative bg-accent/50 w-full h-[150px] sm:h-[200px] mb-2 shadow-none">
                            <a href="{% url 'dashboard:product_detail' product.id %}" class="block">
                                <img alt="{{ product.name|default:'Unnamed Product' }}"
                                     class="h-[100px] sm:h-[150px] shrink-0 object-contain cursor-pointer"
                                     src="{% if product.main_image %}{{ product.main_image }}{% else %}{% static 'default.png' %}{% endif %}"/>
                            </a>
                            {% if product.category.name not in 'Conference,Webinar,Event' %}
                            {% if request.user.is_authenticated %}
                            <span class="kt-wishlist-icon absolute top-2 end-2 cursor-pointer"
                                  data-kt-wishlist-toggle="true"
                                  data-product-id="{{ product.id }}"
                                  title="{% if product.id in user_wishlist_ids %}Remove from Wishlist{% else %}Add to Wishlist{% endif %}">
                                <i class="ki-solid ki-heart {% if product.id in user_wishlist_ids %}text-red-500{% endif %}"></i>
                            </span>
                            {% else %}
                            <span class="kt-wishlist-icon absolute top-2 end-2 cursor-pointer show-login-modal"
                                  title="Login to Add to Wishlist">
                                <i class="ki-solid ki-heart"></i>
                            </span>
                            {% endif %}
                            {% endif %}
                        </div>
                        <h3 class="text-sm font-semibold text-gray-650 leading-snug truncate hover:text-primary transition">
                            {{ product.name }}
                        </h3>
                        <p class="text-xs sm:text-sm text-gray-650 mt-1 truncate">
                            {{ product.description|default:"No description available"|truncatechars:120 }}
                        </p>
                        {% if product.category.name in 'Conference,Webinar,Event' %}
                            {% if product.event and product.event.conference_at %}
                            <p class="text-xs text-green-600 mt-1">
                                Event Date: <strong>{{ product.event.conference_at|date:"D, d M Y, H:i" }}</strong>
                            </p>
                            {% endif %}
                            {% if product.event and product.event.conference_link %}
                            <p class="text-xs text-gray-600 mt-1">
                                Conference Link: <a href="{{ product.event.conference_link }}" class="text-blue-600 hover:underline" target="_blank">Join Here</a>
                            </p>
                            {% endif %}
                        {% else %}
                            {% if product.delivery_date %}
                            <p class="text-xs text-green-600 mt-0.5">
                                Delivery by: <strong>{{ product.delivery_date }}</strong>
                            </p>
                            {% endif %}
                        {% endif %}
                    </div>
                    <div class="flex items-center justify-between flex-wrap gap-2 px-1 pb-1">
                        {% if product.category.name not in 'Conference,Webinar,Event' %}
                        <span class="kt-badge kt-badge-success kt-badge-sm rounded-full gap-1">
                            <i class="ki-solid ki-star text-white -mt-0.5"></i>
                            {{ product.rating|default:"0.0" }}
                        </span>
                        {% endif %}
                        {% if product.total_reviews > 0 %}
                        <span>
                            <span class="text-[11px] text-white/80 ml-1">
                                (<i class="ki-solid ki-eye text-gray-600 -mt-0.5"></i> {{ product.total_reviews }})
                            </span>
                        </span>
                        {% endif %}
                        {% if product.category.name not in 'Conference,Webinar,Event' %}
                        <div class="flex items-center flex-nowrap gap-1 whitespace-nowrap">
                            {% if product.original_price and product.original_price > product.price %}
                            <span class="text-xs font-normal text-secondary-foreground line-through">
                                ${{ product.original_price|floatformat:2 }}
                            </span>
                            {% endif %}
                            <span class="text-sm font-medium text-mono">${{ product.price|floatformat:2 }}</span>
                        </div>
                        {% endif %}
                    </div>
                    <div class="flex items-center flex-wrap gap-2 px-1 product-actions">
                        {% if product.category.name not in 'Conference,Webinar,Event' %}
                            {% if request.user.is_authenticated %}
                                {% if product.id in user_cart_ids %}
                                <button class="kt-btn kt-btn-outline kt-btn-xs flex items-center gap-1"
                                        style="background:#3b82f6; color:white;" data-product-id="{{ product.id }}">
                                    In cart <i class="ki-filled ki-handcart text-white text-xs"></i>
                                </button>
                                {% else %}
                                <button class="kt-btn kt-btn-outline kt-btn-xs flex items-center gap-1 add-to-cart-btn"
                                        data-product-id="{{ product.id }}">
                                    Add <i class="ki-filled ki-handcart text-xs"></i>
                                </button>
                                {% endif %}
                            {% else %}
                                <button class="kt-btn kt-btn-outline kt-btn-xs flex items-center gap-1 show-login-modal">
                                    Add <i class="ki-filled ki-handcart text-xs"></i>
                                </button>
                            {% endif %}
                            {% if request.user.is_authenticated %}
                                {% if product.show_rfq or product.Both %}
                                <button class="kt-btn kt-btn-outline kt-btn-xs flex items-center gap-1 open-rfq-modal"
                                        data-product-id="{{ product.id }}"
                                        data-product-name="{{ product.name }}"
                                        data-product-price="{{ product.price }}"
                                        data-company-name="{{ request.user.wholesalebuyerprofile.company_name|default:'' }}"
                                        data-quantity="1">
                                    RFQ <i class="ki-filled ki-directbox-default text-xs"></i>
                                </button>
                                {% endif %}
                            {% endif %}
                        {% else %}
                            {% if request.user.is_authenticated %}
                                {% if product.id in user_registered_event_ids %}
                                <button class="kt-btn kt-btn-xs bg-blue-600 text-white hover:bg-blue-700 cursor-not-allowed" disabled>
                                    Registered
                                </button>
                                {% else %}
                                <button class="kt-btn kt-btn-xs bg-blue-600 text-white hover:bg-blue-700 open-event-registration-modal"
                                        data-product-id="{{ product.id }}"
                                        data-event-name="{{ product.name }}">
                                    Register for Event
                                </button>
                                {% endif %}
                            {% else %}
                                <button class="kt-btn kt-btn-xs bg-blue-600 text-white hover:bg-blue-700 show-login-modal">
                                    Register for Event
                                </button>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-span-full text-center py-10 text-gray-400">
                No featured products available at the moment.
            </div>
            {% endfor %}
        </div>
    </div>
</div>
<!-- End Featured Products -->
<!-- Special Offers -->
<div class="section-container special-offers-container">
    <div class="space-y-5">
        <div class="flex items-center justify-between gap-4">
            <span class="text-lg font-medium text-gray-100">Special Offers</span>
            <a class="kt-link" href="{% url 'dashboard:search_results_grid' %}?{{ request.GET.urlencode }}">See All <i class="ki-filled ki-right text-xs"></i></a>
        </div>
        <div class="grid xl:grid-cols-2 gap-5 mb-2">
            {% for product in special_offers %}
            {% if forloop.first %}
            <div class="lg:col-span-1">
                <div class="kt-card h-full bg-violet-50 border-violet-200 dark:border-violet-950 dark:bg-violet-950/30 relative">
                    {% if product.offer_active and product.offer_percentage %}
                    <div class="discount-ribbon">save {{ product.offer_percentage|floatformat:0 }}%</div>
                    {% endif %}
                    <div class="kt-card-content flex items-center flex-wrap sm:flex-nowrap justify-between gap-5 lg:gap-9 lg:px-7.5 p-5">
                        <div class="flex flex-col">
                            <div class="mb-3">
                                {% if product.offer_active and product.offer_percentage %}
                                {% endif %}
                            </div>
                            <h3 class="text-xl sm:text-[26px] font-semibold text-mono mb-1">{{ product.name|default:'Unnamed Product' }}</h3>
                            <span class="text-sm font-normal text-foreground mb-5 leading-5.5 line-clamp-1 overflow-hidden">
                                {{ product.description|default:'No description available'|truncatechars:120 }}
                            </span>
                            <div class="flex items-center gap-4 flex-wrap">
                                {% if request.user.is_authenticated %}
                                    {% if product.id in user_cart_ids %}
                                    <button class="kt-btn kt-btn-outline kt-btn-sm ms-1"
                                            style="background:#3b82f6; color:white;" data-product-id="{{ product.id }}">
                                        In cart <i class="ki-filled ki-handcart text-white"></i>
                                    </button>
                                    {% else %}
                                    <button class="kt-btn kt-btn-outline kt-btn-sm ms-1 add-to-cart-btn"
                                            data-product-id="{{ product.id }}">
                                        Add <i class="ki-filled ki-handcart"></i>
                                    </button>
                                    {% endif %}
                                {% else %}
                                    <button class="kt-btn kt-btn-outline kt-btn-sm ms-1 show-login-modal">
                                        Add <i class="ki-filled ki-handcart text-xs"></i>
                                    </button>
                                {% endif %}
                                {% if request.user.is_authenticated %}
                                    {% if product.show_rfq or product.Both %}
                                    <button class="kt-btn kt-btn-outline kt-btn-sm ms-1 open-rfq-modal"
                                            data-product-id="{{ product.id }}"
                                            data-product-name="{{ product.name }}"
                                            data-product-price="{{ product.discounted_price|floatformat:2 }}"
                                            data-company-name="{{ request.user.wholesalebuyerprofile.company_name|default:'' }}"
                                            data-quantity="1">
                                        RFQ <i class="ki-filled ki-directbox-default"></i>
                                    </button>
                                    {% endif %}
                                {% endif %}
                                {% if request.user.is_authenticated %}
                                    <span class="kt-wishlist-icon absolute top-2 end-2 cursor-pointer"
                                          data-kt-wishlist-toggle="true"
                                          data-product-id="{{ product.id }}"
                                          title="{% if product.id in user_wishlist_ids %}Remove from Wishlist{% else %}Add to Wishlist{% endif %}">
                                        <i class="ki-solid ki-heart {% if product.id in user_wishlist_ids %}text-red-500{% endif %}"></i>
                                    </span>
                                {% else %}
                                    <span class="kt-wishlist-icon absolute top-2 end-2 cursor-pointer show-login-modal"
                                          title="Login to Add to Wishlist">
                                        <i class="ki-solid ki-heart"></i>
                                    </span>
                                {% endif %}
                                {% if product.offer_active and product.offer_percentage %}
                                <span class="text-base font-normal text-secondary-foreground line-through pt-[1px]">
                                    ${{ product.price|floatformat:2 }}
                                </span>
                                <span class="text-base font-semibold text-mono">${{ product.discounted_price|floatformat:2 }}</span>
                                {% else %}
                                <span class="text-base font-semibold text-mono">${{ product.price|floatformat:2 }}</span>
                                {% endif %}
                            </div>
                        </div>
                        <a href="{% url 'dashboard:product_detail' product.id %}" class="block">
                            <img alt="{{ product.name|default:'Unnamed Product' }}"
                                 class="size-32 sm:size-48 shrink-0 cursor-pointer product-thumbnail"
                                 src="{% if product.main_image %}{{ product.main_image }}{% else %}{% static 'default.png' %}{% endif %}"
                                 data-product-name="{{ product.name|default:'Unnamed Product' }}"
                                 data-product-description="{{ product.description|default:'No description available' }}"
                                 data-product-image="{% if product.main_image %}{{ product.main_image }}{% else %}{% static 'default.png' %}{% endif %}"
                                 data-product-sku="{{ product.sku|default:'N/A' }}"
                                 data-product-category="{{ product.category|default:'Uncategorized' }}"
                                 data-product-rating="{{ product.rating|default:'4.5' }}"
                                 data-product-more-info="{{ product.more_info|default:'No additional info' }}"
                                 data-product-price="{{ product.discounted_price|floatformat:2 }}"
                                 data-product-original-price="{% if product.offer_active and product.offer_percentage %}{{ product.price|floatformat:2 }}{% endif %}"
                                 data-product-discount="{% if product.offer_active and product.offer_percentage %}save {{ product.offer_percentage|floatformat:0 }}%{% endif %}"/>
                        </a>
                    </div>
                </div>
            </div>
            <div class="lg:col-span-1">
                <div class="grid sm:grid-cols-2 gap-5 items-stretch">
            {% else %}
                    <div class="kt-card h-full bg-green-50 dark:bg-green-950/30 border-green-200 dark:border-green-950 relative">
                        {% if product.offer_active and product.offer_percentage %}
                        <div class="discount-ribbon">save {{ product.offer_percentage|floatformat:0 }}%</div>
                        {% endif %}
                        <div class="kt-card-content flex flex-col items-center justify-center px-5 pb-0">
                            <a href="{% url 'dashboard:product_detail' product.id %}" class="block">
                                <img alt="{{ product.name|default:'Unnamed Product' }}"
                                     class="size-32 sm:size-48 shrink-0 cursor-pointer product-thumbnail"
                                     src="{% if product.main_image %}{{ product.main_image }}{% else %}{% static 'default.png' %}{% endif %}"
                                     data-product-name="{{ product.name|default:'Unnamed Product' }}"
                                     data-product-description="{{ product.description|default:'No description available' }}"
                                     data-product-image="{% if product.main_image %}{{ product.main_image }}{% else %}{% static 'default.png' %}{% endif %}"
                                     data-product-sku="{{ product.sku|default:'N/A' }}"
                                     data-product-category="{{ product.category|default:'Uncategorized' }}"
                                     data-product-rating="{{ product.rating|default:'4.5' }}"
                                     data-product-more-info="{{ product.more_info|default:'No additional info' }}"
                                     data-product-price="{{ product.discounted_price|floatformat:2 }}"
                                     data-product-original-price="{% if product.offer_active and product.offer_percentage %}{{ product.price|floatformat:2 }}{% endif %}"
                                     data-product-discount="{% if product.offer_active and product.offer_percentage %}save {{ product.offer_percentage|floatformat:0 }}%{% endif %}"/>
                            </a>
                            <div class="mb-3.5">
                                {% if product.offer_active and product.offer_percentage %}
                                    <span class="text-sm font-normal text-secondary-foreground line-through pt-[1px]">
                                        ${{ product.price|floatformat:2 }}
                                    </span>
                                    <span class="text-sm font-medium text-mono">${{ product.discounted_price|floatformat:2 }}</span>
                                {% else %}
                                    <span class="text-sm font-medium text-mono">${{ product.price|floatformat:2 }}</span>
                                {% endif %}
                            </div>
                            <span class="text-base font-medium text-mono mb-3">{{ product.name|default:'Unnamed Product' }}</span>
                            <div class="flex items-center gap-2.5 mb-2.5 flex-wrap justify-center">
                                {% if request.user.is_authenticated %}
                                    {% if product.id in user_cart_ids %}
                                    <button class="kt-btn kt-btn-outline kt-btn-sm ms-1"
                                            style="background:#3b82f6; color:white;" data-product-id="{{ product.id }}">
                                        In cart <i class="ki-filled ki-handcart text-white"></i>
                                    </button>
                                    {% else %}
                                    <button class="kt-btn kt-btn-outline kt-btn-sm ms-1 add-to-cart-btn"
                                            data-product-id="{{ product.id }}">
                                        Add <i class="ki-filled ki-handcart"></i>
                                    </button>
                                    {% endif %}
                                {% else %}
                                    <button class="kt-btn kt-btn-outline kt-btn-sm ms-1 show-login-modal">
                                        Add <i class="ki-filled ki-handcart text-xs"></i>
                                    </button>
                                {% endif %}
                                {% if request.user.is_authenticated %}
                                    {% if product.show_rfq or product.Both %}
                                    <button class="kt-btn kt-btn-outline kt-btn-sm ms-1 open-rfq-modal"
                                            data-product-id="{{ product.id }}"
                                            data-product-name="{{ product.name }}"
                                            data-product-price="{{ product.discounted_price|floatformat:2 }}"
                                            data-company-name="{{ request.user.wholesalebuyerprofile.company_name|default:'' }}"
                                            data-quantity="1">
                                        RFQ <i class="ki-filled ki-directbox-default"></i>
                                    </button>
                                    {% endif %}
                                {% endif %}
                                <span class="kt-wishlist-icon absolute top-2 end-2 cursor-pointer"
                                      data-kt-wishlist-toggle="true"
                                      data-product-id="{{ product.id }}"
                                      title="{% if product.id in user_wishlist_ids %}Remove from Wishlist{% else %}Add to Wishlist{% endif %}">
                                    <i class="ki-solid ki-heart {% if product.id in user_wishlist_ids %}text-red-500{% endif %}"></i>
                                </span>
                            </div>
                            {% if product.offer_active and product.offer_percentage %}
                            {% endif %}
                        </div>
                    </div>
            {% endif %}
            {% empty %}
            <div class="col-span-full text-center py-10 text-gray-400">
                No special offers available at the moment.
            </div>
            {% endfor %}
            {% if special_offers and special_offers|length > 1 %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
<!-- New Arrivals -->
<div class="section-container">
    <div class="space-y-4">
        <div class="flex items-center justify-between gap-4">
            <span class="text-lg font-medium text-gray-100">New Arrivals</span>
            <a class="kt-link" href="{% url 'dashboard:search_results_grid' %}?{{ request.GET.urlencode }}">See All <i class="ki-filled ki-right text-xs"></i></a>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 mb-2">
            {% for product in recent_products %}
            <div class="kt-card product-card">
                <div class="kt-card-content flex flex-col justify-between p-2.5 gap-4 h-full">
                    <div class="mb-2.5">
                        <div class="kt-card flex items-center justify-center relative bg-accent/50 w-full h-[180px] sm:h-[250px] mb-4 shadow-none">
                            <a href="{% url 'dashboard:product_detail' product.id %}" class="block">
                                <img alt="{{ product.name|default:'Unnamed Product' }}"
                                     class="h-[150px] sm:h-[180px] shrink-0 cursor-pointer product-thumbnail"
                                     src="{% if product.main_image %}{{ product.main_image }}{% else %}{% static 'default.png' %}{% endif %}"
                                     data-product-name="{{ product.name|default:'Unnamed Product' }}"
                                     data-product-description="{{ product.description|default:'No description available' }}"
                                     data-product-image="{% if product.main_image %}{{ product.main_image }}{% else %}{% static 'default.png' %}{% endif %}"
                                     data-product-sku="{{ product.sku|default:'N/A' }}"
                                     data-product-category="{{ product.category|default:'Uncategorized' }}"
                                     data-product-rating="{{ product.rating|default:'4.5' }}"
                                     data-product-more-info="{{ product.more_info|default:'No additional info' }}"
                                     data-product-price="{{ product.price|default:'0.00' }}"
                                     data-product-original-price="{{ product.original_price|default:'' }}"
                                     data-product-discount="{{ product.offer_percentage|default:'' }}"/>
                            </a>
                            {% if request.user.is_authenticated %}
                            <span class="kt-wishlist-icon absolute top-2 end-2 cursor-pointer"
                                  data-kt-wishlist-toggle="true"
                                  data-product-id="{{ product.id }}"
                                  title="{% if product.id in user_wishlist_ids %}Remove from Wishlist{% else %}Add to Wishlist{% endif %}">
                                <i class="ki-solid ki-heart {% if product.id in user_wishlist_ids %}text-red-500{% endif %}"></i>
                            </span>
                            {% else %}
                            <span class="kt-wishlist-icon absolute top-2 end-2 cursor-pointer show-login-modal"
                                  title="Login to Add to Wishlist">
                                <i class="ki-solid ki-heart"></i>
                            </span>
                            {% endif %}
                        </div>
                        <h3 class="text-md sm:text-lg font-bold text-gray-650 leading-snug truncate hover:text-primary transition">
                            {{ product.name }}
                        </h3>
                        <p class="text-xs sm:text-sm text-gray-650 mt-1 truncate">
                            {{ product.description|default:"No description available"|truncatechars:120 }}
                        </p>
                        {% if product.delivery_date %}
                        <p class="text-xs text-green-600 mt-1">
                            Delivery by: <strong>{{ product.delivery_date }}</strong>
                        </p>
                        {% endif %}
                    </div>
                    <div class="flex items-center flex-wrap justify-between gap-3 px-2.5 pb-1">
                        <span class="kt-badge kt-badge-success kt-badge-sm rounded-full gap-1">
                            <i class="ki-solid ki-star text-white -mt-0.5"></i>
                            {{ product.rating|default:"0.0" }}
                        </span>
                        {% if product.total_reviews > 0 %}
                        <span>
                            <span class="text-[11px] text-white/80 ml-1">
                                (<i class="ki-solid ki-eye text-gray-600 -mt-0.5"></i> {{ product.total_reviews }})</span>
                        </span>
                        {% endif %}
                        <div class="flex items-center flex-wrap gap-1.5">
                            {% if product.original_price and product.original_price > product.price %}
                            <span class="text-xs font-normal text-secondary-foreground line-through pt-[1px]">
                                ${{ product.original_price|floatformat:2 }}
                            </span>
                            {% endif %}
                            <span class="text-sm font-medium text-mono">${{ product.price|floatformat:2 }}</span>
                            {% if request.user.is_authenticated %}
                                {% if product.id in user_cart_ids %}
                                <button class="kt-btn kt-btn-outline kt-btn-sm ms-1"
                                        style="background:#3b82f6; color:white;" data-product-id="{{ product.id }}">
                                    In cart <i class="ki-filled ki-handcart text-white"></i>
                                </button>
                                {% else %}
                                <button class="kt-btn kt-btn-outline kt-btn-sm ms-1 add-to-cart-btn"
                                        data-product-id="{{ product.id }}">
                                    Add <i class="ki-filled ki-handcart"></i>
                                </button>
                                {% endif %}
                            {% else %}
                                <button class="kt-btn kt-btn-outline kt-btn-sm ms-1 show-login-modal">
                                    Add <i class="ki-filled ki-handcart text-xs"></i>
                                </button>
                            {% endif %}
                            {% if request.user.is_authenticated %}
                                {% if product.show_rfq or product.Both %}
                                <button class="kt-btn kt-btn-outline kt-btn-sm ms-1 open-rfq-modal"
                                        data-product-id="{{ product.id }}"
                                        data-product-name="{{ product.name }}"
                                        data-product-price="{{ product.price }}"
                                        data-company-name="{{ request.user.wholesalebuyerprofile.company_name|default:'' }}"
                                        data-quantity="1">
                                    RFQ <i class="ki-filled ki-directbox-default"></i>
                                </button>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-span-full text-center py-10 text-gray-400">
                No new arrivals available at the moment.
            </div>
            {% endfor %}
        </div>
    </div>
</div>

    <!-- Popular Medical Supplies -->
    <div class="section-container">
        <div class="space-y-4">
            <div class="flex items-center justify-between gap-4">
                <span class="text-lg font-medium text-gray-100">Popular Medical Supplies</span>
                <a class="kt-link" href="{% url 'dashboard:search_results_grid' %}?{{ request.GET.urlencode }}">See All <i class="ki-filled ki-right text-xs"></i></a>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 mb-2">
                {% for product in popular_products %}
                <div class="kt-card product-card">
                    <div class="kt-card-content flex flex-col justify-between p-2.5 gap-4 h-full">
                        <div class="mb-2.5">
                            <div class="kt-card flex items-center justify-center relative bg-accent/50 w-full h-[180px] sm:h-[250px] mb-4 shadow-none">
                                <a href="{% url 'dashboard:product_detail' product.id %}" class="block">
                                    <img alt="{{ product.name|default:'Unnamed Product' }}"
                                         class="h-[150px] sm:h-[180px] shrink-0 cursor-pointer product-thumbnail"
                                         src="{% if product.main_image %}{{ product.main_image }}{% else %}{% static 'default.png' %}{% endif %}"
                                         data-product-name="{{ product.name|default:'Unnamed Product' }}"
                                         data-product-description="{{ product.description|default:'No description available' }}"
                                         data-product-image="{% if product.main_image %}{{ product.main_image }}{% else %}{% static 'default.png' %}{% endif %}"
                                         data-product-sku="{{ product.sku|default:'N/A' }}"
                                         data-product-category="{{ product.category|default:'Uncategorized' }}"
                                         data-product-rating="{{ product.rating|default:'4.5' }}"
                                         data-product-more-info="{{ product.more_info|default:'No additional info' }}"
                                         data-product-price="{{ product.price|default:'0.00' }}"
                                         data-product-original-price="{{ product.original_price|default:'' }}"
                                         data-product-discount="{{ product.offer_percentage|default:'' }}"/>
                                </a>
                                {% if request.user.is_authenticated %}
                                <span class="kt-wishlist-icon absolute top-2 end-2 cursor-pointer"
                                      data-kt-wishlist-toggle="true"
                                      data-product-id="{{ product.id }}"
                                      title="{% if product.id in user_wishlist_ids %}Remove from Wishlist{% else %}Add to Wishlist{% endif %}">
                                    <i class="ki-solid ki-heart {% if product.id in user_wishlist_ids %}text-red-500{% endif %}"></i>
                                </span>
                                {% else %}
                                <span class="kt-wishlist-icon absolute top-2 end-2 cursor-pointer show-login-modal"
                                      title="Login to Add to Wishlist">
                                    <i class="ki-solid ki-heart"></i>
                                </span>
                                {% endif %}
                            </div>
                            <h3 class="text-md sm:text-lg font-bold text-gray-650 leading-snug truncate hover:text-primary transition">
                                {{ product.name }}
                            </h3>
                            <p class="text-xs sm:text-sm text-gray-650 mt-1 truncate">
                                {{ product.description|default:"No description available"|truncatechars:120 }}
                            </p>
                            {% if product.delivery_date %}
                            <p class="text-xs text-green-600 mt-1">
                                Delivery by: <strong>{{ product.delivery_date }}</strong>
                            </p>
                            {% endif %}
                        </div>
                        <div class="flex items-center flex-wrap justify-between gap-3 px-2.5 pb-1">
                            <span class="kt-badge kt-badge-success kt-badge-sm rounded-full gap-1">
                                <i class="ki-solid ki-star text-white -mt-0.5"></i>
                                {{ product.rating|default:"0.0" }}
                            </span>
                            {% if product.total_reviews > 0 %}
                            <span>
                                <span class="text-[11px] text-white/80 ml-1">
                                    (<i class="ki-solid ki-eye text-gray-600 -mt-0.5"></i> {{ product.total_reviews }})</span>
                            </span>
                            {% endif %}
                            <div class="flex items-center flex-wrap gap-1.5">
                                {% if product.original_price and product.original_price > product.price %}
                                <span class="text-xs font-normal text-secondary-foreground line-through pt-[1px]">
                                    ${{ product.original_price|floatformat:2 }}
                                </span>
                                {% endif %}
                                <span class="text-sm font-medium text-mono">${{ product.price|floatformat:2 }}</span>
                                {% if request.user.is_authenticated %}
                                    {% if product.id in user_cart_ids %}
                                    <button class="kt-btn kt-btn-outline kt-btn-sm ms-1"
                                            style="background:#3b82f6; color:white;" data-product-id="{{ product.id }}">
                                        In cart <i class="ki-filled ki-handcart text-white"></i>
                                    </button>
                                    {% else %}
                                    <button class="kt-btn kt-btn-outline kt-btn-sm ms-1 add-to-cart-btn"
                                            data-product-id="{{ product.id }}">
                                        Add <i class="ki-filled ki-handcart"></i>
                                    </button>
                                    {% endif %}
                                {% else %}
                                <button class="kt-btn kt-btn-outline kt-btn-sm ms-1 show-login-modal">
                                    Add <i class="ki-filled ki-handcart text-xs"></i>
                                </button>
                                {% endif %}
                                {% if request.user.is_authenticated %}
                                    {% if product.show_rfq or product.Both %}
                                    <button class="kt-btn kt-btn-outline kt-btn-sm ms-1 open-rfq-modal"
                                            data-product-id="{{ product.id }}"
                                            data-product-name="{{ product.name }}"
                                            data-product-price="{{ product.price }}"
                                            data-company-name="{{ request.user.wholesalebuyerprofile.company_name|default:'' }}"
                                            data-quantity="1">
                                        RFQ <i class="ki-filled ki-directbox-default"></i>
                                    </button>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-span-full text-center py-10 text-gray-400">
                    No popular medical supplies available at the moment.
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Limited-Time Deals -->
    <div class="section-container">
        <div class="space-y-4">
            <div class="flex items-center justify-between gap-4">
                <span class="text-lg font-medium text-gray-100">Limited-Time Deals</span>
                <a class="kt-link" href="{% url 'dashboard:search_results_grid' %}?{{ request.GET.urlencode }}">See All <i class="ki-filled ki-right text-xs"></i></a>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 mb-2">
                {% for product in limited_products %}
                <div class="kt-card product-card">
                    <div class="kt-card-content flex flex-col justify-between p-2.5 gap-4 h-full">
                        <div class="mb-2.5">
                            <div class="kt-card flex items-center justify-center relative bg-accent/50 w-full h-[180px] sm:h-[250px] mb-4 shadow-none">
                                <a href="{% url 'dashboard:product_detail' product.id %}" class="block">
                                    <img alt="{{ product.name|default:'Unnamed Product' }}"
                                         class="h-[150px] sm:h-[180px] shrink-0 cursor-pointer product-thumbnail"
                                         src="{% if product.main_image %}{{ product.main_image }}{% else %}{% static 'default.png' %}{% endif %}"
                                         data-product-name="{{ product.name|default:'Unnamed Product' }}"
                                         data-product-description="{{ product.description|default:'No description available' }}"
                                         data-product-image="{% if product.main_image %}{{ product.main_image }}{% else %}{% static 'default.png' %}{% endif %}"
                                         data-product-sku="{{ product.sku|default:'N/A' }}"
                                         data-product-category="{{ product.category|default:'Uncategorized' }}"
                                         data-product-rating="{{ product.rating|default:'4.5' }}"
                                         data-product-more-info="{{ product.more_info|default:'No additional info' }}"
                                         data-product-price="{{ product.price|default:'0.00' }}"
                                         data-product-original-price="{{ product.original_price|default:'' }}"
                                         data-product-discount="{{ product.offer_percentage|default:'' }}"/>
                                </a>
                                {% if request.user.is_authenticated %}
                                <span class="kt-wishlist-icon absolute top-2 end-2 cursor-pointer"
                                      data-kt-wishlist-toggle="true"
                                      data-product-id="{{ product.id }}"
                                      title="{% if product.id in user_wishlist_ids %}Remove from Wishlist{% else %}Add to Wishlist{% endif %}">
                                    <i class="ki-solid ki-heart {% if product.id in user_wishlist_ids %}text-red-500{% endif %}"></i>
                                </span>
                                {% else %}
                                <span class="kt-wishlist-icon absolute top-2 end-2 cursor-pointer show-login-modal"
                                      title="Login to Add to Wishlist">
                                    <i class="ki-solid ki-heart"></i>
                                </span>
                                {% endif %}
                            </div>
                            <h3 class="text-md sm:text-lg font-bold text-gray-650 leading-snug truncate hover:text-primary transition">
                                {{ product.name }}
                            </h3>
                            <p class="text-xs sm:text-sm text-gray-650 mt-1 truncate">
                                {{ product.description|default:"No description available"|truncatechars:120 }}
                            </p>
                            {% if product.delivery_date %}
                            <p class="text-xs text-green-600 mt-1">
                                Delivery by: <strong>{{ product.delivery_date }}</strong>
                            </p>
                            {% endif %}
                        </div>
                        <div class="flex items-center flex-wrap justify-between gap-3 px-2.5 pb-1">
                            <span class="kt-badge kt-badge-success kt-badge-sm rounded-full gap-1">
                                <i class="ki-solid ki-star text-white -mt-0.5"></i>
                                {{ product.rating|default:"0.0" }}
                            </span>
                            {% if product.total_reviews > 0 %}
                            <span>
                                <span class="text-[11px] text-white/80 ml-1">
                                    (<i class="ki-solid ki-eye text-gray-600 -mt-0.5"></i> {{ product.total_reviews }})</span>
                            </span>
                            {% endif %}
                            <div class="flex items-center flex-wrap gap-1.5">
                                {% if product.original_price and product.original_price > product.price %}
                                <span class="text-xs font-normal text-secondary-foreground line-through pt-[1px]">
                                    ${{ product.original_price|floatformat:2 }}
                                </span>
                                {% endif %}
                                <span class="text-sm font-medium text-mono">${{ product.price|floatformat:2 }}</span>
                                {% if request.user.is_authenticated %}
                                    {% if product.id in user_cart_ids %}
                                    <button class="kt-btn kt-btn-outline kt-btn-sm ms-1"
                                            style="background:#3b82f6; color:white;" data-product-id="{{ product.id }}">
                                        In cart <i class="ki-filled ki-handcart text-white"></i>
                                    </button>
                                    {% else %}
                                    <button class="kt-btn kt-btn-outline kt-btn-sm ms-1 add-to-cart-btn"
                                            data-product-id="{{ product.id }}">
                                        Add <i class="ki-filled ki-handcart"></i>
                                    </button>
                                    {% endif %}
                                {% else %}
                                <button class="kt-btn kt-btn-outline kt-btn-sm ms-1 show-login-modal">
                                    Add <i class="ki-filled ki-handcart text-xs"></i>
                                </button>
                                {% endif %}
                                {% if request.user.is_authenticated %}
                                    {% if product.show_rfq or product.Both %}
                                    <button class="kt-btn kt-btn-outline kt-btn-sm ms-1 open-rfq-modal"
                                            data-product-id="{{ product.id }}"
                                            data-product-name="{{ product.name }}"
                                            data-product-price="{{ product.price }}"
                                            data-company-name="{{ request.user.wholesalebuyerprofile.company_name|default:'' }}"
                                            data-quantity="1">
                                        RFQ <i class="ki-filled ki-directbox-default"></i>
                                    </button>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-span-full text-center py-10 text-gray-400">
                    No limited-time deals available at the moment.
                </div>
                {% endfor %}
            </div>
        </div>
    </div>


<!-- Conference & Webinar Events -->
<div class="section-container">
    <div class="space-y-4">
        <div class="flex items-center justify-between gap-4">
            <span class="text-lg font-medium text-gray-100">Conference & Webinar Events</span>
            <a class="kt-link" href="{% url 'dashboard:search_results_grid' %}?category=Conference">See All <i class="ki-filled ki-right text-xs"></i></a>
        </div>
        <!-- Debug output -->
        <p>Number of conference products: {{ conference_products|length }}</p>
        <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 mb-2">
            {% for product in conference_products|slice:":4" %}
            <div class="kt-card product-card">
                <div class="kt-card-content flex flex-col justify-between p-2.5 gap-4 h-full">
                    <div class="mb-2.5">
                        <div class="kt-card flex items-center justify-center relative bg-accent/50 w-full h-[180px] sm:h-[250px] mb-4 shadow-none">
                            <a href="{% url 'dashboard:product_detail' product.id %}" class="block">
                                <img alt="{{ product.name|default:'Unnamed Event' }}"
                                     class="h-[150px] sm:h-[180px] shrink-0 cursor-pointer product-thumbnail"
                                     src="{% if product.main_image %}{{ product.main_image }}{% else %}{% static 'default.png' %}{% endif %}"
                                     data-product-name="{{ product.name|default:'Unnamed Event' }}"
                                     data-product-description="{{ product.description|default:'No description available' }}"
                                     data-product-image="{% if product.main_image %}{{ product.main_image }}{% else %}{% static 'default.png' %}{% endif %}"
                                     data-product-sku="{{ product.supplier_sku|default:'N/A' }}"
                                     data-product-category="{{ product.category.name|default:'Conference' }}"
                                     data-product-rating="{{ product.rating|default:'0.0' }}"
                                     data-product-more-info="{{ product.description|default:'No additional info' }}"
                                     data-product-price="{{ product.discounted_price|default:'0.00' }}"
                                     data-product-original-price="{{ product.price|default:'0.00' }}"
                                     data-product-discount="{{ product.offer_percentage|default:'0' }}"/>
                            </a>
                        </div>
                        <h3 class="text-md sm:text-lg font-bold text-gray-650 leading-snug truncate hover:text-primary transition">
                            {{ product.name }}
                        </h3>
                        <p class="text-xs sm:text-sm text-gray-650 mt-1 truncate">
                            {{ product.description|default:"No description available"|truncatechars:120 }}
                        </p>
                        {% if product.event %}
                            {% if product.event.conference_at %}
                            <p class="text-xs text-green-600 mt-1">
                                Event Date: <strong>{{ product.event.conference_at|date:"D, d M Y, H:i" }}</strong>
                            </p>
                            {% endif %}
                            {% if product.event.speaker_name %}
                            <p class="text-xs text-gray-600 mt-1">
                                Speaker: <strong>{{ product.event.speaker_name }}</strong>
                            </p>
                            {% endif %}
                            {% if product.event.venue %}
                            <p class="text-xs text-gray-600 mt-1">
                                Venue: <strong>{{ product.event.venue }}</strong>
                            </p>
                            {% endif %}
                            {% if product.event.duration %}
                            <p class="text-xs text-gray-600 mt-1">
                                Duration: <strong>{{ product.event.formatted_duration }}</strong>
                            </p>
                            {% endif %}
                            {% if product.event.conference_link %}
                            <p class="text-xs text-gray-600 mt-1">
                                Conference Link: <a href="{{ product.event.conference_link }}" class="text-blue-600 hover:underline" target="_blank">Join Here</a>
                            </p>
                            {% endif %}
                        {% else %}
                            <p class="text-xs text-gray-600 mt-1">No event details available.</p>
                        {% endif %}
                    </div>
                    <div class="flex items-center flex-wrap justify-between gap-3 px-2.5 pb-1">
                        <div class="flex items-center flex-wrap gap-1.5">
                            {% if request.user.is_authenticated %}
                                {% if product.id in user_registered_event_ids %}
                                <button class="kt-btn kt-btn-sm bg-gray-400 text-white cursor-not-allowed" disabled>
                                    Registered
                                </button>
                                {% else %}
                                <button class="kt-btn kt-btn-sm bg-blue-600 text-white hover:bg-blue-700 open-event-registration-modal"
                                        data-product-id="{{ product.id }}"
                                        data-event-name="{{ product.name }}">
                                    Register for Event
                                </button>
                                {% endif %}
                            {% else %}
                                <button class="kt-btn kt-btn-sm bg-blue-600 text-white hover:bg-blue-700 show-login-modal">
                                    Register for Event
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-span-full text-center py-10 text-gray-400">
                No conference or webinar events available at the moment.
            </div>
            {% endfor %}
        </div>
    </div>
</div>

    <!-- Benefits -->
    <div class="section-container">
        <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 mb-2 benefits-grid">
            <div class="kt-card">
                <div class="kt-card-content flex items-center gap-3.5 px-5 py-4">
                    <div class="relative size-[50px] shrink-0">
                        <svg class="w-full h-full stroke-primary/10 fill-primary-soft" fill="none" height="48"
                             viewBox="0 0 44 48" width="44" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16 2.4641C19.7128 0.320509 24.2872 0.320508 28 2.4641L37.6506 8.0359C41.3634 10.1795 43.6506 14.141 43.6506 18.4282V29.5718C43.6506 33.859 41.3634 37.8205 37.6506 39.9641L28 45.5359C24.2872 47.6795 19.7128 47.6795 16 45.5359L6.34937 39.9641C2.63655 37.8205 0.349365 33.859 0.349365 29.5718V18.4282C0.349365 14.141 2.63655 10.1795 6.34937 8.0359L16 2.4641Z"
                                  fill=""></path>
                            <path d="M16.25 2.89711C19.8081 0.842838 24.1919 0.842837 27.75 2.89711L37.4006 8.46891C40.9587 10.5232 43.1506 14.3196 43.1506 18.4282V29.5718C43.1506 33.6804 40.9587 37.4768 37.4006 39.5311L27.75 45.1029C24.1919 47.1572 19.8081 47.1572 16.25 45.1029L6.59937 39.5311C3.04125 37.4768 0.849365 33.6803 0.849365 29.5718V18.4282C0.849365 14.3196 3.04125 10.5232 6.59937 8.46891L16.25 2.89711Z"
                                  stroke=""></path>
                        </svg>
                        <div class="absolute leading-none start-2/4 top-2/4 -translate-y-2/4 -translate-x-2/4">
                            <i class="ki-filled ki-delivery-time text-xl ps-px text-primary"></i>
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <a class="hover:text-primary text-md font-medium text-mono" href="#">Free Delivery</a>
                        <span class="text-xs font-normal text-secondary-foreground">No extra shipping costs</span>
                    </div>
                </div>
            </div>
            <div class="kt-card">
                <div class="kt-card-content flex items-center gap-3.5 px-5 py-4">
                    <div class="relative size-[50px] shrink-0">
                        <svg class="w-full h-full stroke-success-transparent fill-success-soft" fill="none"
                             height="48" viewBox="0 0 44 48" width="44" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16 2.4641C19.7128 0.320509 24.2872 0.320508 28 2.4641L37.6506 8.0359C41.3634 10.1795 43.6506 14.141 43.6506 18.4282V29.5718C43.6506 33.859 41.3634 37.8205 37.6506 39.9641L28 45.5359C24.2872 47.6795 19.7128 47.6795 16 45.5359L6.34937 39.9641C2.63655 37.8205 0.349365 33.859 0.349365 29.5718V18.4282C0.349365 14.141 2.63655 10.1795 6.34937 8.0359L16 2.4641Z"
                                  fill=""></path>
                            <path d="M16.25 2.89711C19.8081 0.842838 24.1919 0.842837 27.75 2.89711L37.4006 8.46891C40.9587 10.5232 43.1506 14.3196 43.1506 18.4282V29.5718C43.1506 33.6804 40.9587 37.4768 37.4006 39.5311L27.75 45.1029C24.1919 47.1572 19.8081 47.1572 16.25 45.1029L6.59937 39.5311C3.04125 37.4768 0.849365 33.6803 0.849365 29.5718V18.4282C0.849365 14.3196 3.04125 10.5232 6.59937 8.46891L16.25 2.89711Z"
                                  stroke=""></path>
                        </svg>
                        <div class="absolute leading-none start-2/4 top-2/4 -translate-y-2/4 -translate-x-2/4">
                            <i class="ki-filled ki-messages text-xl ps-px text-green-500"></i>
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <a class="hover:text-primary text-md font-medium text-mono" href="#">24/7 Support</a>
                        <span class="text-xs font-normal text-secondary-foreground">Help anytime, anywhere</span>
                    </div>
                </div>
            </div>
            <div class="kt-card">
                <div class="kt-card-content flex items-center gap-3.5 px-5 py-4">
                    <div class="relative size-[50px] shrink-0">
                        <svg class="w-full h-full stroke-info-transparent fill-info-soft" fill="none" height="48"
                             viewBox="0 0 44 48" width="44" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16 2.4641C19.7128 0.320509 24.2872 0.320508 28 2.4641L37.6506 8.0359C41.3634 10.1795 43.6506 14.141 43.6506 18.4282V29.5718C43.6506 33.859 41.3634 37.8205 37.6506 39.9641L28 45.5359C24.2872 47.6795 19.7128 47.6795 16 45.5359L6.34937 39.9641C2.63655 37.8205 0.349365 33.859 0.349365 29.5718V18.4282C0.349365 14.141 2.63655 10.1795 6.34937 8.0359L16 2.4641Z"
                                  fill=""></path>
                            <path d="M16.25 2.89711C19.8081 0.842838 24.1919 0.842837 27.75 2.89711L37.4006 8.46891C40.9587 10.5232 43.1506 14.3196 43.1506 18.4282V29.5718C43.1506 33.6804 40.9587 37.4768 37.4006 39.5311L27.75 45.1029C24.1919 47.1572 19.8081 47.1572 16.25 45.1029L6.59937 39.5311C3.04125 37.4768 0.849365 33.6803 0.849365 29.5718V18.4282C0.849365 14.3196 3.04125 10.5232 6.59937 8.46891L16.25 2.89711Z"
                                  stroke=""></path>
                        </svg>
                        <div class="absolute leading-none start-2/4 top-2/4 -translate-y-2/4 -translate-x-2/4">
                            <i class="ki-filled ki-discount text-xl ps-px text-violet-500"></i>
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <a class="hover:text-primary text-md font-medium text-mono" href="#">Discounts</a>
                        <span class="text-xs font-normal text-secondary-foreground">Save big on top deals</span>
                    </div>
                </div>
            </div>
            <div class="kt-card">
                <div class="kt-card-content flex items-center gap-3.5 px-5 py-4">
                    <div class="relative size-[50px] shrink-0">
                        <svg class="w-full h-full stroke-yellow-100 fill-warning-soft" fill="none" height="48"
                             viewBox="0 0 44 48" width="44" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16 2.4641C19.7128 0.320509 24.2872 0.320508 28 2.4641L37.6506 8.0359C41.3634 10.1795 43.6506 14.141 43.6506 18.4282V29.5718C43.6506 33.859 41.3634 37.8205 37.6506 39.9641L28 45.5359C24.2872 47.6795 19.7128 47.6795 16 45.5359L6.34937 39.9641C2.63655 37.8205 0.349365 33.859 0.349365 29.5718V18.4282C0.349365 14.141 2.63655 10.1795 6.34937 8.0359L16 2.4641Z"
                                  fill=""></path>
                            <path d="M16.25 2.89711C19.8081 0.842838 24.1919 0.842837 27.75 2.89711L37.4006 8.46891C40.9587 10.5232 43.1506 14.3196 43.1506 18.4282V29.5718C43.1506 33.6804 40.9587 37.4768 37.4006 39.5311L27.75 45.1029C24.1919 47.1572 19.8081 47.1572 16.25 45.1029L6.59937 39.5311C3.04125 37.4768 0.849365 33.6803 0.849365 29.5718V18.4282C0.849365 14.3196 3.04125 10.5232 6.59937 8.46891L16.25 2.89711Z"
                                  stroke=""></path>
                        </svg>
                        <div class="absolute leading-none start-2/4 top-2/4 -translate-y-2/4 -translate-jx-2/4">
                            <i class="ki-filled ki-credit-cart text-xl ps-px text-yellow-500"></i>
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <a class="hover:text-primary text-md font-medium text-mono" href="#">Money-Back</a>
                        <span class="text-xs font-normal text-secondary-foreground">Full refund, no risk</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- RFQ Modal -->
    <div id="rfqModal"
         class="kt-modal hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"
         data-kt-modal="true" role="dialog" aria-labelledby="rfqModalTitle" aria-modal="true">
        <div class="kt-card w-full max-w-[600px] rounded-xl border border-border bg-background shadow-2xl transition-transform duration-300 ease-in-out transform scale-95">
            <div class="kt-card-header px-5 py-4 flex items-center justify-between border-b border-gray-200 dark:border-gray-700">
                <h2 id="rfqModalTitle" class="text-xl font-bold text-mono">Request for Quotation</h2>
                <button class="kt-btn kt-btn-sm kt-btn-icon kt-btn-ghost shrink-0" onclick="closeRFQModal()"
                        aria-label="Close modal">
                    <i class="ki-filled ki-cross text-base text-gray-500 hover:text-red-500"></i>
                </button>
            </div>
            <form method="POST" action="{% url 'dashboard:rfq_submit' %}" id="rfqForm">
                {% csrf_token %}
                <div class="kt-card-content flex flex-col space-y-4 p-5">
                    <input type="hidden" name="product_id" id="rfqProductId">
                    <div>
                        <label for="rfqProductName"
                               class="block text-sm font-medium text-gray-650 dark:text-gray-300 mb-1">Product</label>
                        <input type="text" id="rfqProductName"
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-md p-2.5 bg-gray-100 dark:bg-gray-800 text-gray-650 dark:text-gray-300 cursor-not-allowed"
                               disabled>
                    </div>
                    <div>
                        <label for="rfqCompanyName"
                               class="block text-sm font-medium text-gray-650 dark:text-gray-300 mb-1">Company Name
                            <span class="text-red-500">*</span></label>
                        <input type="text" name="company_name" id="rfqCompanyName"
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-md p-2.5 focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
                               required aria-required="true">
                        <p class="text-xs text-red-500 mt-1 hidden" id="rfqCompanyNameError">Company name is required.</p>
                    </div>
                    <div>
                        <label for="rfqQuantity"
                               class="block text-sm font-medium text-gray-650 dark:text-gray-300 mb-1">Quantity
                            <span class="text-red-500">*</span></label>
                        <input type="number" name="quantity" id="rfqQuantity"
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-md p-2.5 focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
                               min="1" required aria-required="true">
                        <p class="text-xs text-red-500 mt-1 hidden" id="rfqQuantityError">Quantity must be at least 1.</p>
                    </div>
                    <div>
                        <label for="rfqMessage"
                               class="block text-sm font-medium text-gray-650 dark:text-gray-300 mb-1">Message</label>
                        <textarea name="message" id="rfqMessage"
                                  class="w-full border border-gray-300 dark:border-gray-600 rounded-md p-2.5 focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
                                  rows="4" placeholder="Add any additional details..."></textarea>
                    </div>
                </div>
                <div class="kt-card-footer px-5 py-4 flex justify-end gap-3 border-t border-gray-200 dark:border-gray-700">
                    <button type="button"
                            class="kt-btn kt-btn-outline kt-btn-sm text-gray-650 hover:bg-gray-900 dark:hover:bg-gray-700"
                            onclick="closeRFQModal()"><i class="ki-filled ki-cross"></i>Cancel
                    </button>
                    <button type="submit" class="kt-btn kt-btn-sm bg-blue-600 text-white hover:bg-blue-700 transition-colors flex items-center" id="rfqSubmitBtn">
                        <i class="ki-filled ki-directbox-default"></i>
                        Submit RFQ
                        <span class="loader"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>
    <!-- Event Registration Modal -->
<div id="eventRegistrationModal" class="kt-modal hidden fixed inset-0 z-[9999] flex items-center justify-center bg-black/30 backdrop-blur-sm" data-kt-modal="true" role="dialog" aria-labelledby="eventRegistrationModalTitle" aria-modal="true">
    <div class="kt-card w-full max-w-[600px] rounded-xl border border-border bg-background shadow-2xl transition-transform duration-300 ease-in-out transform scale-95">
        <div class="kt-card-header px-5 py-4 flex items-center justify-between border-b border-gray-200 dark:border-gray-700">
            <h2 id="eventRegistrationModalTitle" class="text-xl font-bold text-mono">Event Registration</h2>
            <button class="kt-btn kt-btn-sm kt-btn-icon kt-btn-ghost shrink-0" onclick="closeEventRegistrationModal()" aria-label="Close modal">
                <i class="ki-filled ki-cross text-base text-gray-500 hover:text-red-500"></i>
            </button>
        </div>
        <form method="POST" action="{% url 'dashboard:event_registration' %}" id="eventRegistrationForm">
            {% csrf_token %}
            <div class="kt-card-content flex flex-col space-y-4 p-5">
                <input type="hidden" name="product_id" id="eventProductId">
                <div>
                    <label for="eventName" class="block text-sm font-medium text-gray-650 dark:text-gray-300 mb-1">Event</label>
                    <input type="text" id="eventName" class="w-full border border-gray-300 dark:border-gray-600 rounded-md p-2.5 bg-gray-100 dark:bg-gray-800 text-gray-650 dark:text-gray-300 cursor-not-allowed" disabled>
                </div>
                <div>
                    <label for="fullName" class="block text-sm font-medium text-gray-650 dark:text-gray-300 mb-1">Full Name <span class="text-red-500">*</span></label>
                    <input type="text" name="full_name" id="fullName" class="w-full border border-gray-300 dark:border-gray-600 rounded-md p-2.5 focus:ring-2 focus:ring-primary focus:border-primary transition-colors" required aria-required="true">
                    <p class="text-xs text-red-500 mt-1 hidden" id="fullNameError">Full name is required.</p>
                </div>
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-650 dark:text-gray-300 mb-1">Email <span class="text-red-500">*</span></label>
                    <input type="email" name="email" id="email" class="w-full border border-gray-300 dark:border-gray-600 rounded-md p-2.5 focus:ring-2 focus:ring-primary focus:border-primary transition-colors" required aria-required="true">
                    <p class="text-xs text-red-500 mt-1 hidden" id="emailError">Valid email is required.</p>
                </div>
                <div>
                    <label for="eventMessage" class="block text-sm font-medium text-gray-650 dark:text-gray-300 mb-1">Additional Notes</label>
                    <textarea name="message" id="eventMessage" class="w-full border border-gray-300 dark:border-gray-600 rounded-md p-2.5 focus:ring-2 focus:ring-primary focus:border-primary transition-colors" rows="4" placeholder="Add any additional details..."></textarea>
                </div>
            </div>
            <div class="kt-card-footer px-5 py-4 flex justify-end gap-3 border-t border-gray-200 dark:border-gray-700">
                <button type="button" class="kt-btn kt-btn-outline kt-btn-sm text-gray-650 hover:bg-gray-900 dark:hover:bg-gray-700" onclick="closeEventRegistrationModal()">
                    <i class="ki-filled ki-cross"></i>Cancel
                </button>
                    <button type="submit" class="kt-btn kt-btn-sm bg-blue-600 text-white hover:bg-blue-700 transition-colors flex items-center" id="eventRegistrationSubmitBtn">
                        <i class="ki-filled ki-check-circle"></i>Register
                        <span class="loader"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Login Required Modal -->
    <div id="loginRequiredModal"
         class="kt-modal hidden fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"
         data-kt-modal="true" role="dialog" aria-labelledby="loginRequiredTitle" aria-modal="true">
        <div class="kt-card w-full max-w-[500px] rounded-xl border border-border bg-background shadow-2xl transition-transform duration-300 ease-in-out transform scale-95">
            <div class="kt-card-header px-5 py-4 flex items-center justify-between border-b border-gray-200 dark:border-gray-700">
                <h2 id="loginRequiredTitle" class="text-xl font-bold text-gray-100">Login Required</h2>
                <button class="kt-btn kt-btn-sm kt-btn-icon kt-btn-ghost shrink-0" onclick="closeLoginModal()" aria-label="Close modal">
                    <i class="ki-filled ki-cross text-base text-gray-500 hover:text-red-500"></i>
                </button>
            </div>
            <div class="kt-card-content p-5 text-center space-y-4">
                <p class="text-gray-650 dark:text-gray-300 text-sm">
                    You must be logged in to perform this action.
                </p>
            </div>
            <div class="kt-card-footer px-5 py-4 flex justify-end gap-3 border-t border-gray-200 dark:border-gray-700">
                <button type="button" class="kt-btn kt-btn-outline kt-btn-sm text-gray-650 hover:bg-gray-900 dark:hover:bg-gray-700" onclick="closeLoginModal()">Cancel</button>
                <a href="{% url 'dashboard:login' %}" class="kt-btn kt-btn-sm bg-blue-600 text-white hover:bg-blue-700 transition-colors flex items-center">
                    Login
                </a>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
    // CSRF Token Helper
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    const csrftoken = getCookie('csrftoken');

    // Wishlist Toggle
    document.addEventListener('DOMContentLoaded', () => {
        const toggleWishlistIcons = (productId, isAdded) => {
            document.querySelectorAll(`.kt-wishlist-icon[data-product-id="${productId}"] i`)
                .forEach(icon => {
                    icon.classList.toggle('text-red-500', isAdded);
                });
        };

        document.querySelectorAll('.kt-wishlist-icon').forEach(button => {
            button.addEventListener('click', () => {
                const productId = button.dataset.productId || '0';
                fetch('/wishlist/toggle/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrftoken,
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `product_id=${productId}`
                })
                .then(response => {
                    if (response.status === 403) {
                        openLoginModal();
                        return;
                    }
                    return response.json();
                })
                .then(data => {
                    if (data) {
                        toggleWishlistIcons(productId, data.status === 'added');
                    }
                })
                .catch(error => console.error('Wishlist toggle error:', error));
            });
        });
    });

    // Add to Cart
    document.addEventListener('DOMContentLoaded', () => {
        const markAsInCart = (btn) => {
            btn.classList.remove('kt-btn-outline');
            btn.classList.add('kt-btn-success');
            btn.style.background = '#3b82f6';
            btn.style.color = 'white';
            btn.innerHTML = `In cart <i class="ki-filled ki-handcart text-white"></i>`;
            btn.onclick = null;
        };

        document.querySelectorAll('.add-to-cart-btn').forEach(button => {
            button.addEventListener('click', () => {
                const productId = button.dataset.productId;
                fetch("{% url 'dashboard:add_to_cart' %}", {
                    method: "POST",
                    headers: {
                        "X-CSRFToken": csrftoken,
                        "Content-Type": "application/x-www-form-urlencoded",
                    },
                    body: new URLSearchParams({
                        product_id: productId,
                        quantity: 1,
                    }),
                })
                .then(res => res.json())
                .then(data => {
                    if (data.status === "success") {
                        document
                            .querySelectorAll(`.add-to-cart-btn[data-product-id="${productId}"]`)
                            .forEach(markAsInCart);
                    } else {
                        alert("Something went wrong");
                    }
                })
                .catch(err => console.error("Add to cart error:", err));
            });
        });
    });

    // Slider JavaScript
    let currentSlide = 0;
    const slider = document.getElementById('slider');
    const totalSlides = slider ? slider.children.length : 0;

    function showSlide(index) {
        if (!slider) return;
        currentSlide = (index + totalSlides) % totalSlides;
        slider.style.transform = `translateX(-${currentSlide * 100}%)`;
    }

    function nextSlide() {
        showSlide(currentSlide + 1);
    }

    function prevSlide() {
        showSlide(currentSlide - 1);
    }

    if (slider) {
        setInterval(nextSlide, 5000);
    }

    // Event Registration Modal Handlers
    document.querySelectorAll('.open-event-registration-modal').forEach(button => {
        button.addEventListener('click', function (e) {
            e.preventDefault();
            const productId = button.getAttribute('data-product-id');
            const eventName = button.getAttribute('data-event-name');

            document.getElementById('eventProductId').value = productId;
            document.getElementById('eventName').value = eventName;

            const modal = document.getElementById('eventRegistrationModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.style.overflow = 'hidden';
        });
    });

    // Login Required Modal
    function openLoginModal() {
        const modal = document.getElementById('loginRequiredModal');
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        document.body.style.overflow = 'hidden';
    }

    function closeLoginModal() {
        const modal = document.getElementById('loginRequiredModal');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.body.style.overflow = '';
    }

    // RFQ Modal
    function closeRFQModal() {
        const modal = document.getElementById('rfqModal');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.body.style.overflow = '';
    }

    document.querySelectorAll('.open-rfq-modal').forEach(button => {
        button.addEventListener('click', () => {
            const productId = button.getAttribute('data-product-id');
            const productName = button.getAttribute('data-product-name');
            const companyName = button.getAttribute('data-company-name');
            const quantity = button.getAttribute('data-quantity');

            document.getElementById('rfqProductId').value = productId;
            document.getElementById('rfqProductName').value = productName;
            document.getElementById('rfqCompanyName').value = companyName;
            document.getElementById('rfqQuantity').value = quantity;

            const modal = document.getElementById('rfqModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.style.overflow = 'hidden';
        });
    });

    // Event Registration Modal
    function closeEventRegistrationModal() {
        const modal = document.getElementById('eventRegistrationModal');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.body.style.overflow = '';
    }

    document.querySelectorAll('.open-event-registration-modal').forEach(button => {
        button.addEventListener('click', function (e) {
            e.preventDefault();
            const productId = button.getAttribute('data-product-id');
            const eventName = button.getAttribute('data-event-name');

            document.getElementById('eventProductId').value = productId;
            document.getElementById('eventName').value = eventName;

            const modal = document.getElementById('eventRegistrationModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.style.overflow = 'hidden';
        });
    });

    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.show-login-modal').forEach(button => {
            button.addEventListener('click', openLoginModal);
        });
    });
</script>
{% endblock %}