{% extends "pages/base.html" %}
{% load static %}

{% block content %}

<title>User Activity Logs</title>

<div class="flex flex-col grow kt-scrollable-y-auto lg:[--kt-scrollbar-width:auto] pt-5" id="scrollable_content" style="max-width: var(--custom-container-width, 100%);">
  <main class="grow" role="content">
   <br><br>
    <!-- Container -->
    <div class="kt-container-fixed px-4 sm:px-6 lg:px-8" style="max-width: var(--custom-container-width, 95%);">
      <div class="grid gap-5 lg:gap-7.5">
        <div class="kt-card kt-card-grid min-w-full">
          <div class="kt-card-header flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3">
            <h3 class="kt-card-title text-lg font-semibold mt-4">Activity Log Details</h3>
            
            <!-- Search Box -->
            <div class="relative">
             
            </div>
          </div>

          <div class="kt-card-table mt-4">
            {% if user_logs %}
            <!-- Desktop table -->
            <div class="hidden md:block kt-scrollable-x-auto overflow-x-auto">
              <table class="kt-table kt-table-border w-full min-w-[900px]" id="logs-table">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="min-w-[80px] text-left py-2 px-3">Log ID</th>
                    <th class="min-w-[120px] text-left py-2 px-3">User</th>
                    <th class="min-w-[100px] text-left py-2 px-3">Action</th>
                    <th class="min-w-[200px] text-left py-2 px-3">Description</th>
                    <th class="min-w-[100px] text-left py-2 px-3">Amount</th>
                    <th class="min-w-[140px] text-left py-2 px-3">Created At</th>
                  </tr>
                </thead>
                <tbody id="logs-tbody">
                  {% for log in user_logs %}
                  <tr class="border-t log-row" 
                      data-action="{{ log.actions }}" 
                      data-date="{{ log.created_at|date:'Y-m-d' }}"
                      data-user="{{ log.user.username|lower }}"
                      data-description="{{ log.description|lower }}">
                    <td class="text-foreground font-normal whitespace-nowrap py-2 px-3">
                      #{{ log.id }}
                    </td>
                    <td class="text-foreground font-normal py-2 px-3">
                      <div class="flex items-center gap-2">
                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 text-blue-600 font-semibold text-xs">
                          {{ log.user.username|slice:":2"|upper }}
                        </div>
                        <span>{{ log.user.username }}</span>
                      </div>
                    </td>
                    <td class="text-foreground font-normal py-2 px-3">
                      {% if log.actions == 'created' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                          ✓ {{ log.get_actions_display }}
                        </span>
                      {% elif log.actions == 'deleted' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                          ✗ {{ log.get_actions_display }}
                        </span>
                      {% elif log.actions == 'logged in' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                          → {{ log.get_actions_display }}
                        </span>
                      {% elif log.actions == 'logged out' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                          ← {{ log.get_actions_display }}
                        </span>
                      {% elif log.actions == 'updated' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                          ↻ {{ log.get_actions_display }}
                        </span>
                      {% elif log.actions == 'purchase' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                          $ {{ log.get_actions_display }}
                        </span>
                      {% elif log.actions == 'payment refund' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                          ↩ {{ log.get_actions_display }}
                        </span>
                      {% elif log.actions == 'failed' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                          ⚠ {{ log.get_actions_display }}
                        </span>
                      {% else %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                          {{ log.get_actions_display }}
                        </span>
                      {% endif %}
                    </td>
                    <td class="text-foreground font-normal py-2 px-3">
                      {{ log.description|default:"—"|truncatewords:15 }}
                    </td>
                    <td class="text-foreground font-normal whitespace-nowrap py-2 px-3">
                      {% if log.amount %}
                        <span class="font-semibold text-green-600">${{ log.amount|floatformat:2 }}</span>
                      {% else %}
                        —
                      {% endif %}
                    </td>
                    <td class="text-foreground font-normal whitespace-nowrap py-2 px-3">
                      <div class="flex flex-col">
                        <span class="text-sm">{{ log.created_at|date:"Y-m-d" }}</span>
                        <span class="text-xs text-muted-foreground">{{ log.created_at|date:"H:i:s" }}</span>
                      </div>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>

            <!-- Mobile card view -->
            <div class="md:hidden space-y-4" id="logs-mobile">
              {% for log in user_logs %}
              <div class="border rounded-lg p-4 bg-white shadow-sm log-card"
                   data-action="{{ log.actions }}" 
                   data-date="{{ log.created_at|date:'Y-m-d' }}"
                   data-user="{{ log.user.username|lower }}"
                   data-description="{{ log.description|lower }}">
                <div class="flex justify-between items-start mb-3">
                  <div class="flex items-center gap-2">
                    <div class="flex items-center justify-center w-10 h-10 rounded-full bg-blue-100 text-blue-600 font-semibold text-sm">
                      {{ log.user.username|slice:":2"|upper }}
                    </div>
                    <div>
                      <div class="text-sm font-semibold">{{ log.user.username }}</div>
                      <div class="text-xs text-muted-foreground">Log #{{ log.id }}</div>
                    </div>
                  </div>
                  <div class="text-xs text-muted-foreground text-right">
                    <div>{{ log.created_at|date:"Y-m-d" }}</div>
                    <div>{{ log.created_at|date:"H:i:s" }}</div>
                  </div>
                </div>
                
                <div class="grid grid-cols-1 gap-2 text-sm">
                  <div>
                    <strong>Action:</strong>
                    {% if log.actions == 'created' %}
                      <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                        ✓ {{ log.get_actions_display }}
                      </span>
                    {% elif log.actions == 'deleted' %}
                      <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                        ✗ {{ log.get_actions_display }}
                      </span>
                    {% elif log.actions == 'logged in' %}
                      <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                        → {{ log.get_actions_display }}
                      </span>
                    {% elif log.actions == 'logged out' %}
                      <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                        ← {{ log.get_actions_display }}
                      </span>
                    {% elif log.actions == 'updated' %}
                      <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                        ↻ {{ log.get_actions_display }}
                      </span>
                    {% elif log.actions == 'purchase' %}
                      <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                        $ {{ log.get_actions_display }}
                      </span>
                    {% else %}
                      <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                        {{ log.get_actions_display }}
                      </span>
                    {% endif %}
                  </div>
                  <div><strong>Description:</strong> {{ log.description|default:"—"|truncatewords:10 }}</div>
                  {% if log.amount %}
                  <div><strong>Amount:</strong> <span class="font-semibold text-green-600">${{ log.amount|floatformat:2 }}</span></div>
                  {% endif %}
                </div>
              </div>
              {% endfor %}
            </div>

            <!-- No Results Message -->
            <div id="no-results" class="hidden text-center py-10">
              <p class="text-base text-muted-foreground">No logs found matching your criteria.</p>
            </div>

            {% else %}
            <p class="text-base text-muted-foreground p-5">No user logs found.</p>
            {% endif %}
          </div>

        
          
        </div>
      </div>
    </div>
    <!-- End of Container -->
     
  </main>
  
</div>

  <!-- Pagination (if needed) -->
  {% if page_obj.has_other_pages %}
  <div class="flex justify-center mt-4">
    <nav class="inline-flex items-center gap-1 text-sm">
  
      {% if page_obj.has_previous %}
        <a href="?page=1" class="px-3 py-1 border rounded">« First</a>
        <a href="?page={{ page_obj.previous_page_number }}" class="px-3 py-1 border rounded">‹ Prev</a>
      {% endif %}
  
      <span class="px-3 py-1 border rounded bg-gray-100">
        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
      </span>
  
      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}" class="px-3 py-1 border rounded">Next ›</a>
        <a href="?page={{ page_obj.paginator.num_pages }}" class="px-3 py-1 border rounded">Last »</a>
      {% endif %}
  
    </nav>
  </div>
  {% endif %}
{% endblock %}