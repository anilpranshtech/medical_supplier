{% extends 'superuser/superuser_base.html' %}
{% load static %}

{% block title %}Top Supplier List{% endblock %}

{% block content %}

<div id="alertContainer" class="mt-3"></div>

<div class="app-main flex-column flex-row-fluid" id="kt_app_main">
  <div class="d-flex flex-column flex-column-fluid">
    <div id="kt_app_content" class="app-content flex-column-fluid mx-5">
      
      <div id="kt_app_content_container" class="app-container container-fluid">
        <div class="card card-flush">
          <div class="card-header flex-wrap align-items-center py-5 gap-4">
            <div class="card-title w-100 w-md-auto">
              <h4 class="fw-bold mb-0">Top Supplier List</h4>
            </div>
          </div>

          <div class="card-body pt-0 table-responsive">
            {% if top_suppliers %}
            <table class="table align-middle table-row-dashed fs-6 gy-5">
              <thead>
                <tr class="text-start text-gray-500 fw-bold fs-7 text-uppercase gs-0">
                  <th class="text-center">#</th>
                  <th class="text-start">Supplier Name</th>
                  <th class="text-center">Email</th>
                  <th class="text-center">Orders</th>
                  <th class="text-center">Joined At</th>
                  <!-- <th class="text-center">Actions</th> -->
                </tr>
              </thead>
              <tbody class="fw-semibold text-gray-600">
                {% for supplier in top_suppliers %}
                <tr>
                  <td class="text-center">{{ forloop.counter }}</td>
                  <td>{{ supplier.company_name }}</td>
                  <td class="text-center">{{ supplier.user.email }}</td>
                  <td class="text-center">{{ supplier.order_count }}</td>
                  <td class="text-center">{{ supplier.user.date_joined|date:"Y-m-d" }}</td>
                  <!-- <td class="text-center">
                    <button class="btn btn-sm btn-light-primary edit-btn"
                            data-id="{{ supplier.id }}"
                            data-supplier="{{ supplier.company_name }}"
                            data-order="{{ supplier.order_count }}">
                      <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn btn-sm btn-light-danger delete-btn" data-id="{{ supplier.id }}">
                      <i class="fas fa-trash"></i> Delete
                    </button>
                  </td> -->
                </tr>
                {% empty %}
                <tr>
                  <td colspan="6" class="text-center">No suppliers found.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            {% else %}
            <p class="text-center text-gray-500 mt-3">No top suppliers found.</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal fade" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Top Supplier</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="editForm" method="POST">
        {% csrf_token %}
        <div class="modal-body">
          <input type="hidden" id="editId" name="id">

          <div class="mb-3">
            <label class="form-label">Supplier Name</label>
            <select id="editSupplier" name="supplier" class="form-select" required>
              <option value="">-- Select Supplier --</option>
              {% for supplier in all_suppliers %}
                <option value="{{ supplier.id }}">{{ supplier.company_name }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Orders</label>
            <input type="number" id="editOrder" name="order" class="form-control" min="0" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const alertContainer = document.getElementById('alertContainer');

  function showAlert(message, type = 'success') {
    alertContainer.innerHTML = `
      <div class="alert alert-${type} alert-dismissible fade show" role="alert">
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    `;
    setTimeout(() => {
      const alert = bootstrap.Alert.getOrCreateInstance(document.querySelector('.alert'));
      alert.close();
    }, 2000);
  }

  // Edit Modal
  document.querySelectorAll('.edit-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      document.getElementById('editId').value = this.dataset.id;
      document.getElementById('editOrder').value = this.dataset.order;

      const supplierName = this.dataset.supplier;
      const supplierSelect = document.getElementById('editSupplier');
      [...supplierSelect.options].forEach(option => {
        option.selected = option.text.trim() === supplierName.trim();
      });

      new bootstrap.Modal(document.getElementById('editModal')).show();
    });
  });

  
 
});
</script>
{% endblock %}
