{% extends 'supplier/base.html' %}
{% load static %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/nouislider@15.7.0/dist/nouislider.min.css" rel="stylesheet">
{% if messages %}
    {% for message in messages %}
        <script>
            alert("{{ message|escapejs }}");
        </script>
    {% endfor %}
{% endif %}
<!--begin::Main-->
<div class="app-main flex-column flex-row-fluid" id="kt_app_main">
    <div class="d-flex flex-column flex-column-fluid">
        <div id="kt_app_content" class="app-content flex-column-fluid">
            <div id="kt_app_content_container" class="app-container container-fluid">
                <form class="form d-flex flex-column flex-lg-row" method="POST" action="{% url 'supplier:edit_product' pk=product.id %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <!-- Left Side Container (Fixed Width) -->
                    <div class="d-flex flex-column gap-7 gap-lg-10 w-100 w-lg-300px mb-7 me-lg-10">
                        <!-- Thumbnail + Gallery Card -->
                        <div class="card card-flush py-4">
                            <div class="card-header">
                                <div class="card-title">
                                    <h2>Thumbnail & Gallery</h2>
                                </div>
                            </div>
                            <div class="card-body text-center pt-0">
                                <!-- Main Thumbnail Upload -->
                                <div class="image-input image-input-outline mb-3" data-kt-image-input="true" style="background-image: url('{% if main_image_url %}{{ main_image_url }}{% else %}https://preview.keenthemes.com/metronic8/demo58/assets/media/svg/files/blank-image.svg{% endif %}')">
                                    <div class="image-input-wrapper w-150px h-150px" style="background-image: url('{% if main_image_url %}{{ main_image_url }}{% endif %}')"></div>
                                    <label class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow"
                                        data-kt-image-input-action="change" data-bs-toggle="tooltip" title="Change avatar">
                                        <i class="fas fa-pen fs-7 text-primary"></i>
                                        <input type="file" name="main_image" accept=".png, .jpg, .jpeg" />
                                        <input type="hidden" name="main_image_remove" />
                                    </label>
                                    {% if main_image_url %}
                                    <span class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow"
                                        data-kt-image-input-action="remove" data-bs-toggle="tooltip" title="Remove avatar">
                                        <i class="bi bi-x-lg"></i>
                                    </span>
                                    {% endif %}
                                </div>
                                <div class="text-muted fs-7 mb-4">Upload the main thumbnail image in the size of 510px x 510px. Only *.png, *.jpg and *.jpeg image files are accepted</div>
                                <!-- Another Images Upload -->
                                <label class="form-label fw-bold">Another Images</label>
                                <input type="file" name="gallery_images" multiple accept=".png, .jpg, .jpeg" class="form-control mb-3" />
                                <!-- Display existing gallery images -->
                                {% if gallery_images %}
                                <div class="mt-3">
                                    <h6>Existing Gallery Images:</h6>
                                    <div class="d-flex flex-wrap gap-2">
                                        {% for image in gallery_images %}
                                        <div class="position-relative">
                                            <img src="{{ image.image.url }}" alt="Gallery image" style="width: 100px; height: 100px; object-fit: cover;">
                                            <a href="{% url 'supplier:delete_product_image' image.id %}" class="btn btn-icon btn-sm btn-danger position-absolute top-0 end-0" title="Delete image">
                                                <i class="fas fa-times"></i>
                                            </a>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        <!-- Status Card -->
                        <div class="card card-flush py-4">
                            <div class="card-header">
                                <div class="card-title">
                                    <h2>Status</h2>
                                </div>
                            </div>
                            <div class="card-body pt-0">
                                <label class="form-label required">Product status</label>
                                <select class="form-select mb-2" data-control="select2" data-hide-search="true" data-placeholder="Select an option" id="kt_ecommerce_add_product_status_select" name="is_active" required>
                                    <option value="True" {% if is_active == 'True' %}selected{% endif %}>Published</option>
                                    <option value="False" {% if is_active == 'False' %}selected{% endif %}>Draft</option>
                                </select>
                                <div class="text-muted fs-7">Set the product status.</div>
                                <div class="d-none mt-10">
                                    <label for="kt_ecommerce_add_product_status_datepicker" class="form-label">Select publishing date and time</label>
                                    <input class="form-control" id="kt_ecommerce_add_product_status_datepicker" placeholder="Pick date & time" />
                                </div>
                            </div>
                        </div>
                        <!-- Categories Card -->
                        <div class="card card-flush py-4">
                            <div class="card-header">
                                <div class="card-title">
                                    <h2>Product Details</h2>
                                </div>
                            </div>
                            <div class="card-body pt-0">
                                <label class="form-label required">Categories</label>
                                <select class="form-select mb-2" name="category" data-control="select2" data-placeholder="Select an option" data-allow-clear="true" required>
                                    <option></option>
                                    {% for cat in categories %}
                                        <option value="{{cat.id }}" {% if category_id|stringformat:"s" == cat.id|stringformat:"s" %}selected{% endif %}>{{cat.name}}</option>
                                    {% endfor %}
                                </select>
                                <div class="text-muted fs-7 mb-7">Add product to a category.</div>
                                <button type="button" class="btn btn-light-primary btn-sm mb-10" data-bs-toggle="modal" data-bs-target="#createCategoryModal">
                                    <i class="fas fa-plus fs-2 text-primary"></i> Create new category
                                </button>
                                <label class="form-label">Sub-Categories</label>
                                <select class="form-select mb-2" name="sub_category" id="subcategory_select" data-control="select2" data-placeholder="Select an option" data-allow-clear="true">
                                    <option value="">Select a Sub-Category</option>
                                    {% if selected_sub_category %}
                                        <option value="{{ selected_sub_category }}" selected>{{ selected_sub_category_name }}</option>
                                    {% endif %}
                                </select>
                                <div class="text-muted fs-7 mb-7">Add product to a sub-category.</div>
                                <button type="button" class="btn btn-light-primary btn-sm mb-10" data-bs-toggle="modal" data-bs-target="#createSubCategoryModal">
                                    <i class="fas fa-plus fs-2 text-primary"></i> Create new sub-category
                                </button>
                                <label class="form-label">Last Categories</label>
                                <select class="form-select mb-2" name="last_category" id="lastcategory_select" data-control="select2" data-placeholder="Select an option" data-allow-clear="true">
                                    <option value="">Select a Last Category</option>
                                    {% if selected_last_category %}
                                        <option value="{{ selected_last_category }}" selected>{{ selected_last_category_name }}</option>
                                    {% endif %}
                                </select>
                                <div class="text-muted fs-7 mb-7">Add product to a last category.</div>
                                <button type="button" class="btn btn-light-primary btn-sm mb-10" data-bs-toggle="modal" data-bs-target="#createLastCategoryModal">
                                    <i class="fas fa-plus fs-2 text-primary"></i> Create new last category
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- Right Side Container -->
                    <div class="d-flex flex-column flex-row-fluid gap-7 gap-lg-10">
                        <div class="row">
                            <div class="col-lg-6">
                                <!-- General Information Card -->
                                <div class="card card-flush py-4">
                                    <div class="card-header">
                                        <div class="card-title">
                                            <h2>General Information</h2>
                                        </div>
                                    </div>
                                    <div class="card-body pt-0">
                                        <div class="mb-10 fv-row">
                                            <label class="required form-label">Product Name</label>
                                            <input type="text" name="product_name" class="form-control mb-2" placeholder="Product name" value="{{ product_name }}" required />
                                            <div class="text-muted fs-7">A product name is required and recommended to be unique.</div>
                                        </div>
                                        <div>
                                            <label class="form-label">Description</label>
                                            <textarea name="product_description" class="form-control" placeholder="Product description">{{ product_description|default:'' }}</textarea><br>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_product_quantity">
                                            <label class="form-label required">Quantity</label>
                                            <input type="number" name="product_quantity" class="form-control mb-2" placeholder="Enter available quantity" value="{{ product_quantity }}" min="1" required />
                                            <div class="text-muted fs-7">Specify how many items are available in stock.</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row">
                                            <label class="form-label required">Brand</label>
                                            <input type="text" name="brand" class="form-control" placeholder="Enter brand" value="{{ brand }}" required/>
                                            <div class="text-muted fs-7">Enter the product brand (new or existing).</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row">
                                            <label class="form-label required">Product From</label>
                                            <input type="text" name="product_from" class="form-control mb-2" placeholder="e.g., India, China" value="{{ product_from }}" required/>
                                            <div class="text-muted fs-7">Country of origin.</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row">
                                            <label class="form-label required">Selling Countries</label>
                                            <input type="text" name="selling_countries" class="form-control mb-2" placeholder="e.g., India, USA, UK" value="{{ selling_countries|default:'' }}" required />
                                            <div class="text-muted fs-7">Comma-separated country names (e.g., India, USA, UK).</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_warranty">
                                            <label class="form-label">Warranty</label>
                                            <select class="form-select mb-2" name="warranty" data-control="select2" data-hide-search="true" data-placeholder="Select a warranty option">
                                                <option value="none" {% if warranty == 'none' %}selected{% endif %}>None</option>
                                                <option value="1yr" {% if warranty == '1yr' %}selected{% endif %}>1 Year</option>
                                                <option value="2yr" {% if warranty == '2yr' %}selected{% endif %}>2 Years</option>
                                            </select>
                                            <div class="text-muted fs-7">Select the product warranty.</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_condition">
                                            <label class="form-label">Condition</label>
                                            <select class="form-select mb-2" name="condition" data-control="select2" data-hide-search="true" data-placeholder="Select a condition">
                                                <option value="new" {% if condition == 'new' %}selected{% endif %}>New</option>
                                                <option value="used" {% if condition == 'used' %}selected{% endif %}>Used</option>
                                            </select>
                                            <div class="text-muted fs-7">Set the product condition.</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row">
                                            <label class="form-label">Is Returnable?</label>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="is_returnable" name="is_returnable" {% if product.is_returnable %}checked{% endif %}>
                                                <label class="form-check-label" for="is_returnable">Enable product return</label>
                                            </div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_return_time_limit">
                                            <label class="form-label required">Return Time Limit (Days)</label>
                                            <input type="number" name="return_time_limit" class="form-control mb-2" placeholder="Enter return time limit in days" value="{{ product.return_time_limit|default:7 }}" min="1"/>
                                            <div class="text-muted fs-7">Number of days for product return.</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_manufacture_date">
                                            <label class="form-label required">Manufacture Date</label>
                                            <input type="date" name="manufacture_date" class="form-control mb-2" placeholder="Select manufacture date" value="{{ manufacture_date }}" required/>
                                            <div class="text-muted fs-7">Date of manufacture.</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_expiry_date">
                                            <label class="form-label required">Expiry Date</label>
                                            <input type="date" name="expiry_date" class="form-control mb-2" placeholder="Select expiry date" value="{{ expiry_date }}" required/>
                                            <div class="text-muted fs-7">Date of expiry.</div>
                                        </div>
                                    </div>
                                </div>
                             <!-- Pricing Card -->
<div class="card card-flush py-4 mt-7" id="hide_field_price">
    <div class="card-header">
        <div class="card-title">
            <h2>Pricing</h2>
        </div>
    </div>
    <div class="card-body pt-0">
        <div class="mb-10 fv-row">
            <label class="required form-label">Base Price</label>
            <input type="text" id="base_price" name="base_price" class="form-control mb-2"
                   placeholder="Product price" value="{{ base_price|default:'' }}" required />
            <div class="text-muted fs-7">Enter a valid product price (1 - 999999, up to 2 decimals).</div>
        </div>
        <div class="mb-10 fv-row d-none" id="discount_price_container">
            <label class="required form-label">Discount Price</label>
            <input type="text" id="discount_price" name="discount_price" class="form-control mb-2"
                   placeholder="Discounted price" value="{{ discount_price|default:'' }}" readonly />
            <div class="text-muted fs-7">The discounted price will be calculated based on the discount percentage.</div>
        </div>
        <div class="fv-row mb-10">
            <label class="fs-6 fw-semibold mb-2 required">
                Discount Type
                <span class="ms-1" data-bs-toggle="tooltip" title="Select a discount type that will be applied to this product">
                    <i class="fas fa-info-circle text-gray-500 fs-6"></i>
                </span>
            </label>
            <div class="row row-cols-1 row-cols-md-3 row-cols-lg-1 row-cols-xl-3 g-9" data-kt-buttons="true" data-kt-buttons-target="[data-kt-button='true']">
                <div class="col">
                    <label class="btn btn-outline btn-outline-dashed btn-active-light-primary d-flex text-start p-6" data-kt-button="true">
                        <span class="form-check form-check-custom form-check-solid form-check-sm align-items-start mt-1">
                            <input class="form-check-input" type="radio" name="discount_option" value="1" {% if discount_option == '1' %}checked{% endif %} />
                        </span>
                        <span class="ms-5">
                            <span class="fs-4 fw-bold text-gray-800 d-block">No Discount</span>
                        </span>
                    </label>
                </div>
                <div class="col">
                    <label class="btn btn-outline btn-outline-dashed btn-active-light-primary d-flex text-start p-6" data-kt-button="true">
                        <span class="form-check form-check-custom form-check-solid form-check-sm align-items-start mt-1">
                            <input class="form-check-input" type="radio" name="discount_option" value="2" {% if discount_option == '2' %}checked{% endif %} />
                        </span>
                        <span class="ms-5">
                            <span class="fs-4 fw-bold text-gray-800 d-block">Percentage %</span>
                        </span>
                    </label>
                </div>
                <div class="col">
                    <label class="btn btn-outline btn-outline-dashed btn-active-light-primary d-flex text-start p-6" data-kt-button="true">
                        <span class="form-check form-check-custom form-check-solid form-check-sm align-items-start mt-1">
                            <input class="form-check-input" type="radio" name="discount_option" value="3" {% if discount_option == '3' %}checked{% endif %} />
                        </span>
                        <span class="ms-5">
                            <span class="fs-4 fw-bold text-gray-800 d-block">Fixed Price</span>
                        </span>
                    </label>
                </div>
            </div>
        </div>
        <div class="mb-10 fv-row" id="kt_ecommerce_add_product_discount_percentage">
            <label class="form-label">Set Discount Percentage</label>
            <div class="d-flex flex-column text-center mb-5">
                <div class="d-flex align-items-start justify-content-center mb-7">
                    <span class="fw-bold fs-3x" id="kt_ecommerce_add_product_discount_label">{{ offer_percentage|default:1 }}</span>
                    <span class="fw-bold fs-4 mt-1 ms-2">%</span>
                </div>
                <div id="kt_ecommerce_add_product_discount_slider" class="noUi-sm"></div>
            </div>
            <div class="text-muted fs-7">Set a percentage discount (1% to 100%) to be applied on this product.</div>
            <input type="hidden" id="offer_percentage" name="offer_percentage" value="{{ offer_percentage|default:1 }}" />
        </div>
        <div class="d-none mb-10 fv-row" id="kt_ecommerce_add_product_discount_fixed">
            <label class="form-label">Fixed Discounted Price</label>
            <input type="text" id="fixed_discounted_price" name="discounted_price" class="form-control mb-2"
                   placeholder="Discounted price" value="{{ discounted_price|default:'' }}" />
            <div class="text-muted fs-7">Set the discounted product price. The product will be reduced at the determined fixed price.</div>
        </div>
    </div>
</div>
                            </div>
                            <!-- Right Column in Right Container -->
                            <div class="col-lg-6">
                                <!-- Additional Details Card -->
                                <div class="card card-flush py-4">
                                    <div class="card-header">
                                        <div class="card-title">
                                            <h2>Additional Details</h2>
                                        </div>
                                    </div>
                                    <div class="card-body pt-0">
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_weight_unit">
                                            <label class="form-label">Weight Unit</label>
                                            <select class="form-select mb-2" name="weight_unit" data-control="select2" data-hide-search="true" data-placeholder="Select weight unit">
                                                <option value="gm" {% if weight_unit == 'gm' %}selected{% endif %}>Gram</option>
                                                <option value="kg" {% if weight_unit == 'kg' %}selected{% endif %}>Kilogram</option>
                                               
                                            </select>
                                            <div class="text-muted fs-7">Unit of product weight.</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_weight">
                                            <label class="form-label required">Weight</label>
                                            <input type="number" name="weight" class="form-control mb-2" placeholder="Enter product weight" value="{{ weight }}" min="1" step="0.01" required/>
                                            <div class="text-muted fs-7">Product weight.</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_delivery_time">
                                            <label class="form-label required">Delivery Time (Days)</label>
                                            <input type="number" name="delivery_time" class="form-control mb-2" placeholder="Enter estimated delivery time in days" value="{{ delivery_time }}" min="1" required/>
                                            <div class="text-muted fs-7">Estimated delivery time in days.</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_keywords">
                                            <label class="form-label required">Keywords</label>
                                            <input type="text" name="keywords" class="form-control mb-2" placeholder="Comma-separated keywords" value="{{ keywords }}" required/>
                                            <div class="text-muted fs-7">Comma-separated keywords for product search.</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_commission_percentage">
                                            <label class="form-label required">Commission Percentage</label>
                                            <input type="number" name="commission_percentage" class="form-control mb-2" placeholder="Enter commission percentage" value="{{ commission_percentage }}" min="1" max="100" step="0.01" required/>
                                            <div class="text-muted fs-7">Commission percentage for the product.</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_barcode">
                                            <label class="form-label">Barcode</label>
                                            <input type="text" name="barcode" class="form-control mb-2" placeholder="Enter barcode" value="{{ barcode }}" />
                                            <div class="text-muted fs-7">Product barcode.</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_brochure">
                                            <label class="form-label">Brochure</label>
                                            {% if brochure_url %}
                                                <div class="mb-2">
                                                    <a href="{{ brochure_url }}" target="_blank" class="btn btn-sm btn-light-primary">
                                                        View Existing Brochure
                                                    </a>
                                                </div>
                                            {% endif %}
                                            <input type="file" name="brochure" class="form-control mb-2" accept=".pdf, .doc, .docx" />
                                            <div class="text-muted fs-7">Upload product brochure (PDF, DOC).</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_supplier_sku">
                                            <label class="form-label required">Supplier SKU</label>
                                            <input type="text" name="supplier_sku" class="form-control mb-2" placeholder="Enter supplier SKU" value="{{ supplier_sku }}" required/>
                                            <div class="text-muted fs-7">Supplier Stock Keeping Unit.</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_pcs_per_unit">
                                            <label class="form-label required">Pcs Per Unit</label>
                                            <input type="number" name="pcs_per_unit" class="form-control mb-2" placeholder="Enter pieces per unit" value="{{ pcs_per_unit }}" min="1" required/>
                                            <div class="text-muted fs-7">Number of pieces in one unit of the product.</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_min_order_qty">
                                            <label class="form-label required">Min Order Qty</label>
                                            <input type="number" name="min_order_qty" class="form-control mb-2" placeholder="Enter minimum order quantity" value="{{ min_order_qty }}" min="1" required/>
                                            <div class="text-muted fs-7">Minimum quantity required for an order.</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_low_stock_alert">
                                            <label class="form-label required">Low Stock Alert</label>
                                            <input type="number" name="low_stock_alert" class="form-control mb-2" placeholder="Enter low stock alert level" value="{{ low_stock_alert }}" min="1" required/>
                                            <div class="text-muted fs-7">Alert when stock falls below this level.</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_expiration_days">
                                            <label class="form-label required">Expiration Days</label>
                                            <input type="number" name="expiration_days" class="form-control mb-2" placeholder="Enter expiration days" value="{{ expiration_days }}" min="1" required/>
                                            <div class="text-muted fs-7">Number of days until product expires.</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_tag">
                                            <label class="form-label">Tag</label>
                                            <select class="form-select mb-2" name="tag" data-control="select2" data-hide-search="true" data-placeholder="Select a tag">
                                                <option value="none" {% if tag == 'none' %}selected{% endif %}>None</option>
                                                <option value="recent" {% if tag == 'recent' %}selected{% endif %}>Recently Arrived</option>
                                                <option value="popular" {% if tag == 'popular' %}selected{% endif %}>Most Wanted</option>
                                                <option value="limited" {% if tag == 'limited' %}selected{% endif %}>Limited Time Deals</option>
                                            </select>
                                            <div class="text-muted fs-7">Assign a tag to the product.</div>
                                        </div>
                                        <!-- <div class="mb-10 mt-4 fv-row" id="hide_field_offer_percentage">
                                            <label class="form-label">Offer Percentage</label>
                                            <input type="number" name="offer_percentage" class="form-control mb-2" placeholder="Enter offer percentage" value="{{ offer_percentage }}" min="0" max="100" step="0.01" />
                                            <div class="text-muted fs-7">Percentage discount for the product.</div>
                                        </div> -->
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_offer_start">
                                            <label class="form-label">Offer Start</label>
                                            <input type="date" name="offer_start" class="form-control mb-2" placeholder="Select offer start date" value="{{ offer_start }}" />
                                            <div class="text-muted fs-7">Date when the offer starts.</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_offer_end">
                                            <label class="form-label">Offer End</label>
                                            <input type="date" name="offer_end" class="form-control mb-2" placeholder="Select offer end date" value="{{ offer_end }}" />
                                            <div class="text-muted fs-7">Date when the offer ends.</div>
                                        </div>
                                        <div class="mb-10 mt-4 fv-row" id="hide_field_offer_status">
                                            <label class="form-label">Offer Status</label>
                                            <div class="form-check form-switch">
                                                <input type="checkbox" class="form-check-input" name="offer_active"
                                                       {% if offer_active %}checked{% endif %}
                                                       {% if not request.user.is_superuser %}disabled{% endif %}>
                                                <label class="form-check-label text-muted">Activate offer</label>
                                            </div>
                                        </div>

                                        <div class="mb-10 mt-4 fv-row" id="hide_field_ask_admin_to_publish">
                                            <label class="form-label">Ask Admin to Approve Offer</label>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="ask_admin_to_publish"
                                                       {% if ask_admin_to_publish %}checked{% endif %}>
                                                <label class="form-check-label">Request admin to publish the offer</label>
                                            </div>
                                        </div>  
                                    </div>
                                </div>
                                <!-- Webinar Fields -->
                                <div id="webinar_fields" class="d-none">
                                    <div class="card card-flush py-4 mt-7">
                                        <div class="card-header">
                                            <div class="card-title">
                                                <h2>Event Details</h2>
                                            </div>
                                        </div>
                                        <div class="card-body pt-0">
                                            <div class="mb-10 fv-row">
                                                <label class="form-label required">Registration Link</label>
                                                <input type="url" name="registration_link" class="form-control" value="{{ product.registration_link|default:'' }}" required />
                                            </div>
                                            <div class="mb-10 fv-row">
                                                <label class="form-label required">Event Name</label>
                                                <input type="text" name="webinar_name" class="form-control" value="{{ product.webinar_name|default:'' }}" required />
                                            </div>
                                            <div class="mb-10 fv-row">
                                                <label class="form-label required">Date</label>
                                                <input type="datetime-local" name="webinar_date" class="form-control" value="{{ product.webinar_date|default:''|date:'Y-m-d\TH:i' }}" required />
                                            </div>
                                            <div class="mb-10 fv-row">
                                                <label class="form-label required">Duration</label>
                                                <input type="text" name="webinar_duration" class="form-control" value="{{ product.webinar_duration|default:'' }}" required />
                                            </div>
                                            <div class="mb-10 fv-row">
                                                <label class="form-label required">Venue</label>
                                                <input type="text" name="webinar_venue" class="form-control" value="{{ product.webinar_venue|default:'' }}" required />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Save/Cancel Buttons -->
                        <div class="d-flex justify-content-end">
                            <a href="{% url 'supplier:products_list' %}" id="kt_ecommerce_add_product_cancel" class="btn btn-light me-5">
                                Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <span class="indicator-label">Save Changes</span>
                                <span class="indicator-progress">
                                    Please wait... <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                                </span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Category forms -->
<div class="modal fade" id="createCategoryModal" tabindex="-1" aria-labelledby="createCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <form method="post" action="{% url 'supplier:create_category' %}">
            {% csrf_token %}
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createCategoryModalLabel">Add New Category</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="category_name" class="form-label required">Category Name</label>
                        <input type="text" class="form-control form-control-solid" name="name" id="category_name" placeholder="Enter category name" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Category</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Sub category add -->
<div class="modal fade" id="createSubCategoryModal" tabindex="-1" aria-labelledby="createSubCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createSubCategoryModalLabel">Create New Sub-Category</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="{% url 'supplier:create_subcategory' %}" method="post"> {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="parent_category" class="form-label">Parent Category</label>
                        <select class="form-select" id="parent_category" name="category" required>
                            <option value="">Select a Category</option>
                            {% for cat in categories %}
                                <option value="{{ cat.id }}">{{ cat.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="subcategory_name" class="form-label">Sub-Category Name</label>
                        <input type="text" class="form-control" id="subcategory_name" name="name" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Create Sub-Category</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Last category add -->
<div class="modal fade" id="createLastCategoryModal" tabindex="-1" aria-labelledby="createLastCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createLastCategoryModalLabel">Create New Last Category</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="{% url 'supplier:create_lastcategory' %}" method="post"> {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="parent_subcategory" class="form-label">Parent Sub-Category</label>
                        <select class="form-select" id="parent_subcategory" name="sub_category" required>
                            <option value="">Select a Sub-Category</option>
                            {% for subcat in subcategories %}
                                <option value="{{ subcat.id }}">{{ subcat.name }} ({{ subcat.category.name }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="lastcategory_name" class="form-label">Last Category Name</label>
                        <input type="text" class="form-control" id="lastcategory_name" name="name" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Create Last Category</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}

{% block page_only_scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/nouislider@15.7.0/dist/nouislider.min.js"></script>
<script>
$(document).ready(function () {
    // Form submit loader
    $('form').on('submit', function(e) {
        $('.indicator-label').hide();
        $('.indicator-progress').show();
        const formData = new FormData(this);
        console.log('Form data on submit:', Object.fromEntries(formData));
        return true;
    });

    // Subcategory AJAX
    $('select[name="category"]').on('change', function () {
        let categoryId = $(this).val();
        if (categoryId) {
            $.ajax({
                url: "{% url 'supplier:get_subcategories' %}",
                data: {
                    'category_id': categoryId
                },
                success: function (data) {
                    let options = '<option value="">Select a Sub-Category</option>';
                    data.forEach(function (item) {
                        options += `<option value="${item.id}" ${item.id == '{{ selected_sub_category }}' ? 'selected' : ''}>${item.name}</option>`;
                    });
                    $('#subcategory_select').html(options).trigger('change');
                    $('#lastcategory_select').html('<option value="">Select a Last Category</option>').trigger('change');
                }
            });
        } else {
            $('#subcategory_select').html('<option value="">Select a Sub-Category</option>').trigger('change');
            $('#lastcategory_select').html('<option value="">Select a Last Category</option>').trigger('change');
        }
        toggleFormFields();
    });

    // Lastcategory AJAX
    $('#subcategory_select').on('change', function () {
        let subCatId = $(this).val();
        if (subCatId) {
            $.ajax({
                url: "{% url 'supplier:get_lastcategories' %}",
                data: {
                    'sub_id': subCatId
                },
                success: function (data) {
                    let options = '<option value="">Select a Last Category</option>';
                    data.forEach(function (item) {
                        options += `<option value="${item.id}" ${item.id == '{{ selected_last_category }}' ? 'selected' : ''}>${item.name}</option>`;
                    });
                    $('#lastcategory_select').html(options).trigger('change');
                }
            });
        } else {
            $('#lastcategory_select').html('<option value="">Select a Last Category</option>').trigger('change');
        }
    });

    // Discount option toggle and calculations
    const radios = document.querySelectorAll('input[name="discount_option"]');
    const percentageSection = document.getElementById('kt_ecommerce_add_product_discount_percentage');
    const fixedSection = document.getElementById('kt_ecommerce_add_product_discount_fixed');
    const basePriceInput = document.getElementById('base_price');
    const discountPriceInput = document.getElementById('discount_price');
    const discountPriceContainer = document.getElementById('discount_price_container');
    const fixedPriceInput = document.getElementById('fixed_discounted_price');
    const offerPercentageInput = document.getElementById('offer_percentage');
    const discountLabel = document.getElementById('kt_ecommerce_add_product_discount_label');

    if (percentageSection && fixedSection && basePriceInput && discountPriceInput && discountPriceContainer && offerPercentageInput && discountLabel) {
        const sliderElement = document.getElementById('kt_ecommerce_add_product_discount_slider');

        // Initialize noUiSlider
        if (sliderElement) {
            const initialPercentage = Math.max(parseInt(offerPercentageInput.value) || 1, 1);
            noUiSlider.create(sliderElement, {
                start: initialPercentage,
                step: 1,
                connect: [true, false],
                range: {
                    'min': 1,
                    'max': 100
                },
                format: {
                    to: function (value) {
                        return Math.round(value);
                    },
                    from: function (value) {
                        return Number(value);
                    }
                }
            });

            // Update discount label and hidden input on slider change
            sliderElement.noUiSlider.on('update', function (values, handle) {
                const percentage = values[handle];
                discountLabel.textContent = percentage;
                offerPercentageInput.value = percentage;
                updateDiscountPrice();
            });
        }

        // Function to calculate and update discount price
        function updateDiscountPrice() {
            const basePrice = parseFloat(basePriceInput.value) || 0;
            const selectedOption = document.querySelector('input[name="discount_option"]:checked')?.value;

            if (!selectedOption) {
                console.error('No discount option selected');
                return;
            }

            // Clear any previous validation states
            basePriceInput.classList.remove('is-invalid');
            if (fixedPriceInput) {
                fixedPriceInput.classList.remove('is-invalid');
            }
            const errorMessages = document.querySelectorAll('.text-muted.fs-7');
            errorMessages.forEach(el => {
                el.classList.remove('text-danger');
                el.classList.add('text-muted');
                el.textContent = el.getAttribute('data-original-text') || el.textContent;
            });

            if (selectedOption === '1') {
                discountPriceInput.value = basePrice.toFixed(2);
                discountPriceContainer.classList.add('d-none');
                offerPercentageInput.value = 0;
            } else if (selectedOption === '2') {
                const percentage = Math.max(parseFloat(offerPercentageInput.value) || 1, 1);
                offerPercentageInput.value = percentage;
                discountLabel.textContent = percentage;
                const discountAmount = basePrice * (percentage / 100);
                discountPriceInput.value = (basePrice - discountAmount).toFixed(2);
                discountPriceContainer.classList.remove('d-none');
            } else if (selectedOption === '3') {
                const fixedPrice = parseFloat(fixedPriceInput.value) || basePrice;
                discountPriceInput.value = fixedPrice.toFixed(2);
                discountPriceContainer.classList.add('d-none');
                offerPercentageInput.value = 0;
            }
            console.log('updateDiscountPrice - base_price:', basePriceInput.value, 'offer_percentage:', offerPercentageInput.value, 'discount_price:', discountPriceInput.value);
        }

        // Update on base price input
        basePriceInput.addEventListener('input', function () {
            const value = parseFloat(this.value);
            const helpText = this.nextElementSibling;
            if (isNaN(value) || value < 1 || value > 999999) {
                this.classList.add('is-invalid');
                helpText.classList.remove('text-muted');
                helpText.classList.add('text-danger');
                helpText.textContent = 'Please enter a valid price (1 - 999999, up to 2 decimals).';
            } else {
                this.classList.remove('is-invalid');
                helpText.classList.remove('text-danger');
                helpText.classList.add('text-muted');
                helpText.textContent = helpText.getAttribute('data-original-text') || 'Enter a valid product price (1 - 999999, up to 2 decimals).';
            }
            updateDiscountPrice();
        });

        // Update on fixed price input
        if (fixedPriceInput) {
            fixedPriceInput.addEventListener('input', function () {
                const value = parseFloat(this.value);
                const helpText = this.nextElementSibling;
                if (isNaN(value) || value < 0 || value > 999999) {
                    this.classList.add('is-invalid');
                    helpText.classList.remove('text-muted');
                    helpText.classList.add('text-danger');
                    helpText.textContent = 'Please enter a valid discounted price (0 - 999999, up to 2 decimals).';
                } else {
                    this.classList.remove('is-invalid');
                    helpText.classList.remove('text-danger');
                    helpText.classList.add('text-muted');
                    helpText.textContent = helpText.getAttribute('data-original-text') || 'Set the discounted product price.';
                }
                updateDiscountPrice();
            });
        }

        // Handle discount option radio button changes
        radios.forEach(function (radio) {
            radio.addEventListener('change', function () {
                // Clear validation states
                basePriceInput.classList.remove('is-invalid');
                if (fixedPriceInput) {
                    fixedPriceInput.classList.remove('is-invalid');
                }
                const errorMessages = document.querySelectorAll('.text-muted.fs-7');
                errorMessages.forEach(el => {
                    el.classList.remove('text-danger');
                    el.classList.add('text-muted');
                    el.textContent = el.getAttribute('data-original-text') || el.textContent;
                });

                if (this.value === '1') {
                    percentageSection.classList.add('d-none');
                    fixedSection.classList.add('d-none');
                    discountPriceContainer.classList.add('d-none');
                    offerPercentageInput.value = 0;
                } else if (this.value === '2') {
                    percentageSection.classList.remove('d-none');
                    fixedSection.classList.add('d-none');
                    discountPriceContainer.classList.remove('d-none');
                    if (sliderElement && sliderElement.noUiSlider) {
                        const currentPercentage = Math.max(parseInt(sliderElement.noUiSlider.get()) || 1, 1);
                        sliderElement.noUiSlider.set(currentPercentage);
                        offerPercentageInput.value = currentPercentage;
                        discountLabel.textContent = currentPercentage;
                    }
                } else if (this.value === '3') {
                    percentageSection.classList.add('d-none');
                    fixedSection.classList.remove('d-none');
                    discountPriceContainer.classList.add('d-none');
                    offerPercentageInput.value = 0;
                }
                updateDiscountPrice();
            });
        });

        // Initialize form based on selected radio
        const checkedRadio = document.querySelector('input[name="discount_option"]:checked');
        if (checkedRadio) {
            checkedRadio.dispatchEvent(new Event('change'));
        } else {
            console.warn('No discount option selected on load, defaulting to No Discount');
            document.querySelector('input[name="discount_option"][value="1"]').checked = true;
            document.querySelector('input[name="discount_option"][value="1"]').dispatchEvent(new Event('change'));
        }
    } else {
        console.error('Required pricing elements not found');
    }

    // Conditional logic for Webinar, Event, Conference
    const categorySelect = document.querySelector('select[name="category"]');
    const webinarFields = document.getElementById('webinar_fields');
    const webinarCategories = ["Webinar", "Conference", "Event"];
    const isReturnableToggle = document.getElementById("is_returnable");
    const returnTimeLimitField = document.getElementById("hide_field_return_time_limit");

    const fieldsToHide = [
        "hide_field_product_quantity", "hide_field_warranty", "hide_field_condition",
        "hide_field_return_time_limit", "hide_field_is_returnable", "hide_field_manufacture_date",
        "hide_field_expiry_date", "hide_field_barcode", "hide_field_price",
        "hide_field_weight_unit", "hide_field_weight", "hide_field_delivery_time",
        "hide_field_commission_percentage", "hide_field_supplier_sku",
        "hide_field_pcs_per_unit", "hide_field_min_order_qty", "hide_field_low_stock_alert",
        "hide_field_expiration_days", "hide_field_tag", "hide_field_offer_percentage",
        "hide_field_offer_start", "hide_field_offer_end", "hide_field_keywords",
        "hide_field_brochure"
    ];

    function toggleFormFields() {
        const selectedText = categorySelect.options[categorySelect.selectedIndex]?.text.trim() || "";
        const isWebinar = webinarCategories.includes(selectedText);

        // Toggle visibility and required status for fields in fieldsToHide
        fieldsToHide.forEach(id => {
            const field = document.getElementById(id);
            if (field) {
                field.style.display = isWebinar ? "none" : "";
                field.querySelectorAll("input, select, textarea").forEach(el => {
                    if (isWebinar) {
                        el.removeAttribute("required");
                    } else {
                        if (el.hasAttribute("data-originally-required")) {
                            el.setAttribute("required", "required");
                        }
                    }
                });
            }
        });

        // Ensure supplier field is always visible and required
        const supplierField = document.getElementById("hide_field_supplier");
        if (supplierField) {
            supplierField.style.display = "";
            supplierField.querySelectorAll("select").forEach(el => {
                if (el.hasAttribute("data-originally-required")) {
                    el.setAttribute("required", "required");
                }
            });
        }

        // Toggle webinar fields
        if (webinarFields) {
            webinarFields.classList.toggle("d-none", !isWebinar);
            webinarFields.querySelectorAll("input").forEach(el => {
                if (isWebinar) {
                    el.setAttribute("required", "required");
                } else {
                    el.removeAttribute("required");
                }
            });
        }

        // Toggle return time limit field
        if (isReturnableToggle && returnTimeLimitField) {
            returnTimeLimitField.style.display = isReturnableToggle.checked && !isWebinar ? "" : "none";
            returnTimeLimitField.querySelectorAll("input").forEach(el => {
                if (isReturnableToggle.checked && !isWebinar) {
                    el.setAttribute("required", "required");
                } else {
                    el.removeAttribute("required");
                }
            });
        }

        // Disable is_returnable toggle for webinars
        if (isReturnableToggle) {
            isReturnableToggle.disabled = isWebinar;
            if (isWebinar) {
                isReturnableToggle.checked = false;
            }
        }
    }

    // Store original required state
    fieldsToHide.concat(["hide_field_supplier"]).forEach(id => {
        const field = document.getElementById(id);
        if (field) {
            field.querySelectorAll("input, select, textarea").forEach(el => {
                if (el.hasAttribute("required")) {
                    el.setAttribute("data-originally-required", "true");
                }
            });
        }
    });

    // Store original help text for reset
    document.querySelectorAll('.text-muted.fs-7').forEach(el => {
        el.setAttribute('data-original-text', el.textContent);
    });

    // Attach listeners
    if (categorySelect) {
        categorySelect.addEventListener("change", toggleFormFields);
    }
    if (isReturnableToggle) {
        isReturnableToggle.addEventListener("change", toggleFormFields);
    }

    // Run on page load
    toggleFormFields();
});

// Input validations from Add Product with red error text
document.addEventListener("DOMContentLoaded", function () {
    const manufactureDate = document.getElementById("hide_field_manufacture_date").querySelector("input");
    const expiryDate = document.getElementById("hide_field_expiry_date").querySelector("input");
    const offerStart = document.getElementById("hide_field_offer_start").querySelector("input");
    const offerEnd = document.getElementById("hide_field_offer_end").querySelector("input");
    const keywords = document.getElementById("hide_field_keywords").querySelector("input");
    const productName = document.querySelector('input[name="product_name"]');
    const productFrom = document.querySelector('input[name="product_from"]');
    const sellingCountries = document.querySelector('input[name="selling_countries"]');

    const today = new Date().toISOString().split("T")[0];

    // Manufacture Date Validation
    manufactureDate?.addEventListener("input", function () {
        const helpText = this.nextElementSibling;
        if (manufactureDate.value > today) {
            manufactureDate.setCustomValidity("Manufacture Date cannot be in the future.");
            manufactureDate.classList.add('is-invalid');
            helpText.classList.remove('text-muted');
            helpText.classList.add('text-danger');
            helpText.textContent = 'Manufacture Date cannot be in the future.';
        } else {
            manufactureDate.setCustomValidity("");
            manufactureDate.classList.remove('is-invalid');
            helpText.classList.remove('text-danger');
            helpText.classList.add('text-muted');
            helpText.textContent = helpText.getAttribute('data-original-text') || 'Date of manufacture.';
        }
        // Trigger expiry date validation
        if (expiryDate.value) {
            expiryDate.dispatchEvent(new Event('input'));
        }
    });

    // Expiry Date Validation
    expiryDate?.addEventListener("input", function () {
        const helpText = this.nextElementSibling;
        if (manufactureDate.value && expiryDate.value <= manufactureDate.value) {
            expiryDate.setCustomValidity("Expiry Date must be later than Manufacture Date.");
            expiryDate.classList.add('is-invalid');
            helpText.classList.remove('text-muted');
            helpText.classList.add('text-danger');
            helpText.textContent = 'Expiry Date must be later than Manufacture Date.';
        } else {
            expiryDate.setCustomValidity("");
            expiryDate.classList.remove('is-invalid');
            helpText.classList.remove('text-danger');
            helpText.classList.add('text-muted');
            helpText.textContent = helpText.getAttribute('data-original-text') || 'Date of expiry.';
        }
    });

    // Offer Start Validation
    offerStart?.addEventListener("input", function () {
        const helpText = this.nextElementSibling;
        if (offerStart.value < today) {
            offerStart.setCustomValidity("Offer Start Date cannot be in the past.");
            offerStart.classList.add('is-invalid');
            helpText.classList.remove('text-muted');
            helpText.classList.add('text-danger');
            helpText.textContent = 'Offer Start Date cannot be in the past.';
        } else if (offerEnd.value && offerStart.value >= offerEnd.value) {
            offerStart.setCustomValidity("Offer Start Date must be earlier than Offer End Date.");
            offerStart.classList.add('is-invalid');
            helpText.classList.remove('text-muted');
            helpText.classList.add('text-danger');
            helpText.textContent = 'Offer Start Date must be earlier than Offer End Date.';
        } else {
            offerStart.setCustomValidity("");
            offerStart.classList.remove('is-invalid');
            helpText.classList.remove('text-danger');
            helpText.classList.add('text-muted');
            helpText.textContent = helpText.getAttribute('data-original-text') || 'Date when the offer starts.';
        }
        // Trigger offer end validation
        if (offerEnd.value) {
            offerEnd.dispatchEvent(new Event('input'));
        }
    });

    // Offer End Validation
    offerEnd?.addEventListener("input", function () {
        const helpText = this.nextElementSibling;
        if (offerStart.value && offerEnd.value <= offerStart.value) {
            offerEnd.setCustomValidity("Offer End Date must be later than Offer Start Date.");
            offerEnd.classList.add('is-invalid');
            helpText.classList.remove('text-muted');
            helpText.classList.add('text-danger');
            helpText.textContent = 'Offer End Date must be later than Offer Start Date.';
        } else {
            offerEnd.setCustomValidity("");
            offerEnd.classList.remove('is-invalid');
            helpText.classList.remove('text-danger');
            helpText.classList.add('text-muted');
            helpText.textContent = helpText.getAttribute('data-original-text') || 'Date when the offer ends.';
        }
    });

    // Keywords Validation
    keywords?.addEventListener("input", function () {
        const regex = /^[a-zA-Z\s]+(,[a-zA-Z\s]+)*$/;
        const helpText = this.nextElementSibling;
        if (keywords.value.trim() === "") {
            keywords.setCustomValidity("Keywords field cannot be empty.");
            keywords.classList.add('is-invalid');
            helpText.classList.remove('text-muted');
            helpText.classList.add('text-danger');
            helpText.textContent = 'Keywords field cannot be empty.';
        } else if (!regex.test(keywords.value)) {
            keywords.setCustomValidity("Only text and commas are allowed. Numbers or special characters are not allowed.");
            keywords.classList.add('is-invalid');
            helpText.classList.remove('text-muted');
            helpText.classList.add('text-danger');
            helpText.textContent = 'Only text and commas are allowed. Numbers or special characters are not allowed.';
        } else {
            keywords.setCustomValidity("");
            keywords.classList.remove('is-invalid');
            helpText.classList.remove('text-danger');
            helpText.classList.add('text-muted');
            helpText.textContent = helpText.getAttribute('data-original-text') || 'Comma-separated keywords for product search.';
        }
    });

    // Product Name Validation
    productName?.addEventListener("input", function () {
        const regex = /^[a-zA-Z0-9\s\-_]+$/;
        const helpText = this.nextElementSibling;
        if (productName.value.trim() === "") {
            productName.setCustomValidity("Product Name cannot be empty.");
            productName.classList.add('is-invalid');
            helpText.classList.remove('text-muted');
            helpText.classList.add('text-danger');
            helpText.textContent = 'Product Name cannot be empty.';
        } else if (!regex.test(productName.value)) {
            productName.setCustomValidity("Product Name can only contain letters, numbers, spaces, hyphen (-), and underscore (_).");
            productName.classList.add('is-invalid');
            helpText.classList.remove('text-muted');
            helpText.classList.add('text-danger');
            helpText.textContent = 'Product Name can only contain letters, numbers, spaces, hyphen (-), and underscore (_).';
        } else {
            productName.setCustomValidity("");
            productName.classList.remove('is-invalid');
            helpText.classList.remove('text-danger');
            helpText.classList.add('text-muted');
            helpText.textContent = helpText.getAttribute('data-original-text') || 'A product name is required and recommended to be unique.';
        }
    });

    // Product From Validation
    productFrom?.addEventListener("input", function () {
        const regex = /^[a-zA-Z\s]+$/;
        const helpText = this.nextElementSibling;
        if (productFrom.value.trim() === "") {
            productFrom.setCustomValidity("Product From cannot be empty.");
            productFrom.classList.add('is-invalid');
            helpText.classList.remove('text-muted');
            helpText.classList.add('text-danger');
            helpText.textContent = 'Product From cannot be empty.';
        } else if (!regex.test(productFrom.value)) {
            productFrom.setCustomValidity("Product From can only contain letters and spaces.");
            productFrom.classList.add('is-invalid');
            helpText.classList.remove('text-muted');
            helpText.classList.add('text-danger');
            helpText.textContent = 'Product From can only contain letters and spaces.';
        } else {
            productFrom.setCustomValidity("");
            productFrom.classList.remove('is-invalid');
            helpText.classList.remove('text-danger');
            helpText.classList.add('text-muted');
            helpText.textContent = helpText.getAttribute('data-original-text') || 'Country of origin.';
        }
    });

    // Selling Countries Validation
    sellingCountries?.addEventListener("input", function () {
        const regex = /^[a-zA-Z\s]+(,[a-zA-Z\s]+)*$/;
        const helpText = this.nextElementSibling;
        if (sellingCountries.value.trim() === "") {
            sellingCountries.setCustomValidity("Selling Countries cannot be empty.");
            sellingCountries.classList.add('is-invalid');
            helpText.classList.remove('text-muted');
            helpText.classList.add('text-danger');
            helpText.textContent = 'Selling Countries cannot be empty.';
        } else if (!regex.test(sellingCountries.value)) {
            sellingCountries.setCustomValidity("Only country names separated by commas are allowed (letters and spaces only).");
            sellingCountries.classList.add('is-invalid');
            helpText.classList.remove('text-muted');
            helpText.classList.add('text-danger');
            helpText.textContent = 'Only country names separated by commas are allowed (letters and spaces only).';
        } else {
            sellingCountries.setCustomValidity("");
            sellingCountries.classList.remove('is-invalid');
            helpText.classList.remove('text-danger');
            helpText.classList.add('text-muted');
            helpText.textContent = helpText.getAttribute('data-original-text') || 'Comma-separated country names (e.g., India, USA, UK).';
        }
    });

    // Trigger initial validations for pre-filled fields
    [productName, productFrom, sellingCountries, keywords, manufactureDate, expiryDate, offerStart, offerEnd, basePriceInput, fixedPriceInput].forEach(input => {
        if (input && input.value) {
            input.dispatchEvent(new Event('input'));
        }
    });
});
</script>
{% endblock page_only_scripts %}